import{a as te,b as H,c as ie}from"./chunk-EKVMEYYK.js";import{a as V,c as re}from"./chunk-NTPKRG57.js";import{a as j}from"./chunk-IL6FGR6O.js";import{a as Y,b as ee}from"./chunk-RFR63KKH.js";import"./chunk-3QIFBVMG.js";import{b as ne,c as oe}from"./chunk-D2CL3KRH.js";import{a as L,d as R}from"./chunk-C6P4MNK7.js";import{c as X,d as K,f as J}from"./chunk-LEP5KRIK.js";import{x as Q}from"./chunk-VO7SG4EQ.js";import{B as Z,Cb as p,Db as q,Eb as _,Fb as P,Ia as D,Ka as a,Pa as m,Q as T,T as A,Va as S,_a as g,a as G,b as $,eb as M,fb as x,hb as E,ia as C,ib as u,ja as k,jb as I,ka as v,kb as B,la as z,lb as F,mb as o,nb as r,ob as f,pb as w,ra as W,sb as b,tb as l,ua as U,xa as h,z as N}from"./chunk-ETUXU3TJ.js";function ue(t,s){if(t&1&&(o(0,"h2",9),p(1),r()),t&2){let e=l(2);a(),_(" ",(e.anime.title.ja==null?null:e.anime.title.ja.main)||e.anime.title.main," ")}}function fe(t,s){if(t&1&&(o(0,"div",23),p(1),r()),t&2){let e=l(2);E("badge-success",e.anime.info.season.endsWith("spring"))("badge-error",e.anime.info.season.endsWith("summer"))("badge-warning",e.anime.info.season.endsWith("autumn"))("badge-info",e.anime.info.season.endsWith("winter")),a(),_(" ",e.anime.info.season.split("/").slice(-2).join(" ")," ")}}function he(t,s){if(t&1&&(o(0,"div",11),p(1),r()),t&2){let e=l(2);a(),_(" ",e.anime.info.type," ")}}function ve(t,s){if(t&1&&(o(0,"div",13),p(1),r()),t&2){let e=l(2);a(),_(" ",e.anime.info.startDate," ")}}function ge(t,s){t&1&&(o(0,"div",14),p(1,"|"),r())}function _e(t,s){if(t&1&&(o(0,"div",15),p(1),r()),t&2){let e=l(2);a(),_(" ",e.anime.info.endDate," ")}}function xe(t,s){if(t&1&&(o(0,"div",17),p(1),r()),t&2){let e=l(2);a(),P(" ",e.anime.info.aggregateRating==null||e.anime.info.aggregateRating.value==null?null:e.anime.info.aggregateRating.value.toFixed(2)," (",e.anime.info.aggregateRating==null?null:e.anime.info.aggregateRating.count,") ")}}function be(t,s){if(t&1&&(o(0,"div",18),p(1),r()),t&2){let e=l(2);a(),P(" ",e.anime.info.averageRating==null||e.anime.info.averageRating.value==null?null:e.anime.info.averageRating.value.toFixed(2)," (",e.anime.info.averageRating==null?null:e.anime.info.averageRating.count,") ")}}function Se(t,s){if(t&1&&(o(0,"a",20),v(),o(1,"svg",21),f(2,"path",22),r(),p(3," x.com "),r()),t&2){let e=l(2);x("href",e.xLink(),D)}}function Ce(t,s){if(t&1){let e=w();o(0,"div",0)(1,"div",1)(2,"figure",2),f(3,"img",3),r(),o(4,"div",4)(5,"button",5),b("click",function(){C(e);let n=l();return k(n.isBookmarked()?n.removeBookmark():n.addBookmark())}),v(),o(6,"svg",6),f(7,"path",7),r()()()(),z(),o(8,"div",8),g(9,ue,2,1,"h2",9)(10,fe,2,9,"div",10)(11,he,2,1,"div",11),o(12,"div",12),g(13,ve,2,1,"div",13)(14,ge,2,0,"div",14)(15,_e,2,1,"div",15),r(),o(16,"div",16),g(17,xe,2,2,"div",17)(18,be,2,2,"div",18),r(),o(19,"div",19)(20,"a",20),v(),o(21,"svg",21),f(22,"path",22),r(),p(23," anidb.net "),r(),g(24,Se,4,1,"a",20),r()()()}if(t&2){let e=l();a(3),x("src","/api/content/image/"+e.anime.title.aid,D)("alt",e.anime.title.main||e.anime.title.aid),a(),M("data-tip",e.isBookmarked()?"Remove bookmark":"Add bookmark"),a(),E("text-warning",e.isBookmarked()),a(),M("fill",e.isBookmarked()?"currentColor":"none")("stroke",e.isBookmarked()?"currentColor":"white"),a(3),u(e.anime.title.ja!=null&&e.anime.title.ja.main||e.anime.title.main?9:-1),a(),u(e.anime.info.season?10:-1),a(),u(e.anime.info.type?11:-1),a(2),u(e.anime.info.startDate?13:-1),a(),u(e.anime.info.startDate&&e.anime.info.endDate?14:-1),a(),u(e.anime.info.endDate?15:-1),a(2),u(e.anime.info.aggregateRating!=null&&e.anime.info.aggregateRating.value&&(e.anime.info.aggregateRating!=null&&e.anime.info.aggregateRating.count)?17:-1),a(),u(e.anime.info.averageRating!=null&&e.anime.info.averageRating.value&&(e.anime.info.averageRating!=null&&e.anime.info.averageRating.count)?18:-1),a(2),x("href","https://anidb.net/anime/"+e.anime.title.aid,D),a(4),u(e.xLink().length>0?24:-1)}}var ae=(()=>{class t{bookmarkService;eventService;libraryService;_anime=null;xLink=h("");isBookmarked=h(!1);isRefetching=h(!1);subscription;constructor(e,i,n){this.bookmarkService=e,this.eventService=i,this.libraryService=n,this.subscription=this.eventService.on(ne).subscribe(()=>this.checkBookmark())}ngOnDestroy(){this.subscription.unsubscribe()}set anime(e){this._anime=e,this.checkBookmark(),this.xLink.set(this.getXLink(e?.info.officialWebsite)||"")}get anime(){return this._anime}getXLink(e){return e?.split(" ").find(i=>i.includes("twitter.com")||i.includes("x.com"))}getBookmark(e){return{label:e.title.ja?.main||e.title.main||String(e.title.aid),path:e.path}}addBookmark(){this.anime&&!this.isBookmarked()&&this.bookmarkService.add(this.getBookmark(this.anime))}removeBookmark(){this.anime&&this.isBookmarked()&&this.bookmarkService.remove(this.getBookmark(this.anime))}checkBookmark(){if(this.anime){let e=this.anime.path;this.bookmarkService.get().subscribe(i=>{this.isBookmarked.set(i.some(n=>n.path===e))})}else this.isBookmarked.set(!1)}static \u0275fac=function(i){return new(i||t)(m(oe),m(L),m(R))};static \u0275cmp=S({type:t,selectors:[["app-anime-panel"]],inputs:{anime:"anime"},decls:1,vars:1,consts:[[1,"card","h-full","w-full","bg-base-100"],[1,"relative","flex","flex-col","h-83","px-4","pt-4"],[1,"h-83"],[1,"rounded-xl","object-cover","h-full","w-full",3,"src","alt"],[1,"absolute","top-7","right-7","tooltip","tooltip-left"],[1,"cursor-pointer","hover:scale-125","text-warning",3,"click"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 24 24","stroke-width","2",1,"size-6"],["stroke-linecap","round","stroke-linejoin","round","d","M11.48 3.499a.562.562 0 0 1 1.04 0l2.125 5.111a.563.563 0 0 0 .475.345l5.518.442c.499.04.701.663.321.988l-4.204 3.602a.563.563 0 0 0-.182.557l1.285 5.385a.562.562 0 0 1-.84.61l-4.725-2.885a.562.562 0 0 0-.586 0L6.982 20.54a.562.562 0 0 1-.84-.61l1.285-5.386a.562.562 0 0 0-.182-.557l-4.204-3.602a.562.562 0 0 1 .321-.988l5.518-.442a.563.563 0 0 0 .475-.345L11.48 3.5Z"],[1,"card-body","items-center","text-center"],[1,"card-title","text-lg","font-bold"],[1,"badge","badge-soft",3,"badge-success","badge-error","badge-warning","badge-info"],[1,"text-sm","font-semibold","opacity-50"],[1,"flex","items-center","gap-2"],["data-tip","Start date",1,"tooltip"],[1,"text-lg","pb-1","font-bold"],["data-tip","End date",1,"tooltip"],[1,"flex","gap-2"],["data-tip","Aggregate rating",1,"tooltip"],["data-tip","Average rating",1,"tooltip"],[1,"card-actions"],["target","_blank","rel","noopener noreferrer",1,"btn","btn-sm","btn-ghost",3,"href"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke-width","1.5","stroke","currentColor",1,"size-4"],["stroke-linecap","round","stroke-linejoin","round","d","M13.5 6H5.25A2.25 2.25 0 0 0 3 8.25v10.5A2.25 2.25 0 0 0 5.25 21h10.5A2.25 2.25 0 0 0 18 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25"],[1,"badge","badge-soft"]],template:function(i,n){i&1&&g(0,Ce,25,17,"div",0),i&2&&u(n.anime?0:-1)},encapsulation:2,changeDetection:0})}return t})();function we(t,s){if(t&1){let e=w();o(0,"button",1),b("click",function(){let n=C(e).$index,d=l();return k(d.onClick(n))}),p(1),r(),o(2,"span"),v(),o(3,"svg",2),f(4,"path",3),r()()}if(t&2){let e=s.$implicit;a(),_(" ",e.label," ")}}var se=(()=>{class t{toastService;items=[];selected=new W;constructor(e){this.toastService=e}async copy(e){try{await navigator.clipboard.writeText(e)}catch(i){let n="Failed to copy text";this.toastService.emit("error",n),console.error(n,i)}}get currentDirectory(){let e=this.items;return e.length===1?e[0].path:e[0].path+e[e.length-1].path}onClick(e){e===this.items.length-1&&this.copy(this.currentDirectory),this.selected.emit(e)}static \u0275fac=function(i){return new(i||t)(m(j))};static \u0275cmp=S({type:t,selectors:[["app-breadcrumbs"]],inputs:{items:"items"},outputs:{selected:"selected"},decls:3,vars:0,consts:[[1,"flex","items-center","my-2","gap-1","overflow-x-auto","overflow-y-hidden"],[1,"btn","btn-ghost",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke-width","5","stroke","currentColor",1,"size-3","pt-0.5"],["stroke-linecap","round","stroke-linejoin","round","d","m8.25 4.5 7.5 7.5-7.5 7.5"]],template:function(i,n){i&1&&(o(0,"nav",0),B(1,we,5,1,null,null,I),r()),i&2&&(a(),F(n.items))},encapsulation:2,changeDetection:0})}return t})();function Ee(t,s){if(t&1){let e=w();o(0,"th")(1,"label")(2,"input",7),b("click",function(n){return C(e),k(n.preventDefault())}),r()()()}if(t&2){let e=l().$index,i=l();a(2),x("id","file-list-checkbox-"+e)("checked",i.selection().includes(e))}}function Te(t,s){if(t&1&&(o(0,"th",3),p(1),r()),t&2){let e=l().$index;a(),q(e+1)}}function Ae(t,s){t&1&&(v(),o(0,"svg",5),f(1,"path",8),r())}function De(t,s){t&1&&(v(),o(0,"svg",5),f(1,"path",9),r())}function Ie(t,s){t&1&&(v(),o(0,"svg",5),f(1,"path",10),r())}function Be(t,s){t&1&&(v(),o(0,"svg",5),f(1,"path",11),r())}function Fe(t,s){t&1&&(v(),o(0,"svg",5),f(1,"path",12),r())}function Le(t,s){t&1&&(v(),o(0,"svg",5),f(1,"path",13),r())}function Re(t,s){if(t&1){let e=w();o(0,"tr",2),b("click",function(){let n=C(e).$index,d=l();return k(d.onClick(n))}),g(1,Ee,3,2,"th")(2,Te,2,1,"th",3),o(3,"td",4),g(4,Ae,2,0,":svg:svg",5)(5,De,2,0,":svg:svg",5)(6,Ie,2,0,":svg:svg",5)(7,Be,2,0,":svg:svg",5)(8,Fe,2,0,":svg:svg",5)(9,Le,2,0,":svg:svg",5),r(),o(10,"td",6),p(11),r(),o(12,"td"),p(13),r()()}if(t&2){let e,i=s.$implicit,n=s.$index,d=l();E("text-info",d.selection().includes(n)),a(),u(d.showSelection()?1:2),a(3),u((e=i.type)==="directory"?4:e==="audio"?5:e==="video"?6:e==="image"?7:e==="text"?8:9),a(7),_(" ",i.name," "),a(2),_(" ",i.extension," ")}}var le=(()=>{class t{actionService;selectionService;selected=U();items=h([]);showSelection=h(!1);selection=h([]);subscriptions=[];ngOnDestroy(){this.subscriptions.forEach(e=>e.unsubscribe())}set entries(e){this.selection.set([]),this.items.set(e)}constructor(e,i){this.actionService=e,this.selectionService=i,this.subscriptions.push(this.selectionService.onToggleSelection().subscribe(n=>{this.showSelection.set(n),this.selection.set([])}))}onClick(e){if(this.showSelection())this.selection.update(i=>i.includes(e)?i.filter(n=>n!==e):[...i,e]),this.selectionService.selected=this.selection().map(i=>this.items()[i].name);else{this.selection.set([e]);let i=this.items()[e];i.isDirectory?this.selected.emit(i):(this.selectionService.selected=[i.name],this.actionService.run())}}static \u0275fac=function(i){return new(i||t)(m(re),m(V))};static \u0275cmp=S({type:t,selectors:[["app-file-list"]],inputs:{entries:"entries"},outputs:{selected:"selected"},decls:4,vars:0,consts:[[1,"table","table-zebra"],[1,"row-hover","cursor-pointer",3,"text-info"],[1,"row-hover","cursor-pointer",3,"click"],[1,"min-w-13","max-w-13"],[1,"px-0"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke-width","1.5","stroke","currentColor",1,"size-6"],[1,"w-full","whitespace-normal"],["type","checkbox",1,"checkbox","checkbox-sm",3,"click","id","checked"],["stroke-linecap","round","stroke-linejoin","round","d","M2.25 12.75V12A2.25 2.25 0 0 1 4.5 9.75h15A2.25 2.25 0 0 1 21.75 12v.75m-8.69-6.44-2.12-2.12a1.5 1.5 0 0 0-1.061-.44H4.5A2.25 2.25 0 0 0 2.25 6v12a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18V9a2.25 2.25 0 0 0-2.25-2.25h-5.379a1.5 1.5 0 0 1-1.06-.44Z"],["stroke-linecap","round","stroke-linejoin","round","d","m9 9 10.5-3m0 6.553v3.75a2.25 2.25 0 0 1-1.632 2.163l-1.32.377a1.803 1.803 0 1 1-.99-3.467l2.31-.66a2.25 2.25 0 0 0 1.632-2.163Zm0 0V2.25L9 5.25v10.303m0 0v3.75a2.25 2.25 0 0 1-1.632 2.163l-1.32.377a1.803 1.803 0 0 1-.99-3.467l2.31-.66A2.25 2.25 0 0 0 9 15.553Z"],["stroke-linecap","round","stroke-linejoin","round","d","m15.75 10.5 4.72-4.72a.75.75 0 0 1 1.28.53v11.38a.75.75 0 0 1-1.28.53l-4.72-4.72M4.5 18.75h9a2.25 2.25 0 0 0 2.25-2.25v-9a2.25 2.25 0 0 0-2.25-2.25h-9A2.25 2.25 0 0 0 2.25 7.5v9a2.25 2.25 0 0 0 2.25 2.25Z"],["stroke-linecap","round","stroke-linejoin","round","d","m2.25 15.75 5.159-5.159a2.25 2.25 0 0 1 3.182 0l5.159 5.159m-1.5-1.5 1.409-1.409a2.25 2.25 0 0 1 3.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 0 0 1.5-1.5V6a1.5 1.5 0 0 0-1.5-1.5H3.75A1.5 1.5 0 0 0 2.25 6v12a1.5 1.5 0 0 0 1.5 1.5Zm10.5-11.25h.008v.008h-.008V8.25Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z"],["stroke-linecap","round","stroke-linejoin","round","d","M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"],["stroke-linecap","round","stroke-linejoin","round","d","M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"]],template:function(i,n){i&1&&(o(0,"table",0)(1,"tbody"),B(2,Re,14,6,"tr",1,I),r()()),i&2&&(a(2),F(n.items()))},encapsulation:2,changeDetection:0})}return t})();function Ve(t,s){if(t&1&&f(0,"app-anime-panel",5),t&2){let e=l();x("anime",e.title())("@enterLeaveAnimation",void 0)}}function je(t){if(t.isDirectory)return"";let s=t.name.match(/\.([a-zA-Z0-9]+)$/);return s?s[1].toLowerCase():""}function Ne(t){return t.length===0?"directory":["mp3","flac"].includes(t)?"audio":["mp4","mkv","webm"].includes(t)?"video":["jpg","png","webp"].includes(t)?"image":["txt"].includes(t)?"text":"others"}var Mt=(()=>{class t{router;route;eventService;explorerService;libraryService;selectionService;toastService;HIDDEN_ANIMATION_DONE="FILES_HIDDEN";library=h(null);filter="";sort="NAME";rawBreadcrumbs=[];breadcrumbs=h([]);rawEntries=[];entries=h([]);title=h(null);isLoading=h(!1);subscriptions=[];ngOnDestroy(){this.subscriptions.forEach(e=>e.unsubscribe())}refreshConfig(){return this.explorerService.fileTabConfig.pipe(A(e=>{this.filter=e.filter,this.sort=e.sort}))}getLibraryIndex(){return this.route.parent?Number(this.route.parent.snapshot.paramMap.get("index")):0}getPathItems(){let e=this.route.snapshot.queryParamMap.get("path");if(!e)return[];let i=e.replace(/\\/g,"/").split("/"),n=[],d="";for(let c of i)c.length>0&&(d+="/"+c,n.push({label:c,path:d}));return n}onNavigationEnd(){return N([this.libraryService.getDetail(this.getLibraryIndex()),this.refreshConfig()]).pipe(A(([e])=>{e&&(this.library.set(e.library),this.rawBreadcrumbs=[{label:e.library.label,path:e.library.path}].concat(this.getPathItems()),this.explore())}))}constructor(e,i,n,d,c,y,ce){this.router=e,this.route=i,this.eventService=n,this.explorerService=d,this.libraryService=c,this.selectionService=y,this.toastService=ce,this.onNavigationEnd().subscribe(),this.subscriptions.push(this.router.events.pipe(Z(me=>me instanceof X),T(()=>this.onNavigationEnd())).subscribe()),this.subscriptions.push(this.eventService.on(te).pipe(T(()=>this.refreshConfig()),A(()=>this.applyConfig())).subscribe()),this.subscriptions.push(this.eventService.on(H).pipe(T(()=>this.onNavigationEnd())).subscribe())}applyConfig(){let e=this.filter,i=this.sort,n=null;e.length>0&&(n=new RegExp(Q(e),"i"));let d=this.rawEntries.filter(c=>n!==null?n.test(c.name)||n.test(c.type):!0).sort((c,y)=>c.isDirectory&&!y.isDirectory?-1:!c.isDirectory&&y.isDirectory?1:i==="NAME_R"?y.name.localeCompare(c.name):c.name.localeCompare(y.name));this.entries.set(d),this.breadcrumbs.set(this.rawBreadcrumbs)}asEntryItem(e){let i=je(e);return $(G({},e),{type:Ne(i),extension:i})}get currentDirectory(){let e=this.rawBreadcrumbs;return e.length===1?e[0].path:e[0].path+e[e.length-1].path}explore(){if(this.isLoading()||this.rawBreadcrumbs.length===0)return;this.isLoading.set(!0);let e=this.currentDirectory;this.selectionService.directory=e,N([this.libraryService.getTitle(e),this.explorerService.explore(e),this.eventService.once(this.HIDDEN_ANIMATION_DONE)]).subscribe({next:([i,n])=>{this.rawEntries=n.map(this.asEntryItem),this.applyConfig(),this.title.set(i),this.isLoading.set(!1),this.selectionService.selected=[]},error:i=>{console.error(i),this.toastService.emit("warning","Redirect to home page"),this.router.navigate([""])}})}onAnimationEnd(e){e.toState==="hidden"&&this.eventService.emit(this.HIDDEN_ANIMATION_DONE)}enter(e){if(this.isLoading()||!e.isDirectory)return;let i=this.rawBreadcrumbs,n=i.length===1?"":i[i.length-1].path;this.router.navigate([],{relativeTo:this.route,queryParams:{path:n+"/"+e.name}})}onClickPathItem(e){if(e===this.rawBreadcrumbs.length-1){this.eventService.emit(H);return}this.router.navigate([],{relativeTo:this.route,queryParams:{path:e===0?"":this.rawBreadcrumbs[e].path}})}static \u0275fac=function(i){return new(i||t)(m(J),m(K),m(L),m(ie),m(R),m(V),m(j))};static \u0275cmp=S({type:t,selectors:[["app-file-tab"]],decls:6,vars:4,consts:[[1,"flex","flex-col","h-full","w-full"],[1,"grid","grid-cols-1",3,"selected","items"],[1,"grow","min-h-0","h-full","w-full"],[1,"flex","h-full","w-full"],[1,"grow","h-full","overflow-y-auto","overflow-x-hidden",3,"selected","entries"],[1,"shrink-0","h-full","w-0","md:w-67","overflow-y-auto","overflow-x-hidden",3,"anime"]],template:function(i,n){i&1&&(o(0,"div",0)(1,"app-breadcrumbs",1),b("selected",function(c){return n.onClickPathItem(c)}),r(),o(2,"div",2)(3,"div",3)(4,"app-file-list",4),b("selected",function(c){return n.enter(c)})("@fadeAnimation.done",function(c){return n.onAnimationEnd(c)}),r(),g(5,Ve,1,2,"app-anime-panel",5),r()()()),i&2&&(a(),x("items",n.breadcrumbs()),a(3),x("entries",n.entries())("@fadeAnimation",n.isLoading()?"hidden":"visible"),a(),u(n.title()?5:-1))},dependencies:[se,le,ae],encapsulation:2,data:{animation:[Y,ee]},changeDetection:0})}return t})();export{Mt as FileTabComponent};
