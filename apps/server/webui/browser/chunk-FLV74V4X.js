import{a as le}from"./chunk-ZDHPGFRA.js";import{b as L}from"./chunk-RFR63KKH.js";import{c as ee,d as R,f as A,g as j,h as F}from"./chunk-3QIFBVMG.js";import{b as ce,c as me,d as pe}from"./chunk-KOMMF4BV.js";import{a as ae,e as se,f as V}from"./chunk-EZ4CD3YJ.js";import{c as te,d as ie,e as ne,f as oe,i as re}from"./chunk-GAV62O7C.js";import{a as de,c as ue,f as _e,l as he}from"./chunk-K6FZPC3A.js";import{z as P}from"./chunk-T4XCOYID.js";import{B as G,Cb as p,Db as U,Eb as S,Gb as Y,Hb as J,Ia as W,Ib as X,Ja as q,Ka as s,Pa as _,Q as H,T as E,Va as y,Xa as Z,_a as C,fb as v,hb as I,ia as k,ib as f,ja as T,jb as N,ka as M,kb as B,la as D,lb as O,mb as o,nb as a,ob as h,pb as w,ra as b,sb as c,tb as m,ua as K,va as $,wa as z,xa as d}from"./chunk-X3KZUPYP.js";var ve=(()=>{class n{ref;clickOutside=K();constructor(e){this.ref=e}onClick(e){this.ref.nativeElement.contains(e)||this.clickOutside.emit()}static \u0275fac=function(t){return new(t||n)(_(z))};static \u0275dir=Z({type:n,selectors:[["","appClickOutside",""]],hostBindings:function(t,i){t&1&&c("click",function(l){return i.onClick(l.target)},!1,q)},outputs:{clickOutside:"clickOutside"}})}return n})();var fe=(()=>{class n{selected=new b;anime=$.required();static \u0275fac=function(t){return new(t||n)};static \u0275cmp=y({type:n,selectors:[["app-anime-row"]],inputs:{anime:[1,"anime"]},outputs:{selected:"selected"},decls:9,vars:4,consts:[["aria-hidden","true",1,"list-row","cursor-pointer","hover:bg-base-300",3,"click"],[1,"flex","items-center","justify-center","h-23","w-23"],["aria-hidden","true",1,"rounded-xl","object-cover","h-23","w-23","cursor-pointer",3,"click","src","alt"],[1,"font-semibold"],[1,"text-lg"],[1,"text-xs","opacity-50"]],template:function(t,i){if(t&1&&(o(0,"li",0),c("click",function(){return i.selected.emit()}),o(1,"div",1)(2,"figure")(3,"img",2),c("click",function(){return i.selected.emit()}),a()()(),o(4,"div",3)(5,"div",4),p(6),a(),o(7,"div",5),p(8),a()()()),t&2){let r;s(3),v("src","/api/content/image/"+i.anime().title.aid,W)("alt",i.anime().title.main||i.anime().title.aid),s(3),S(" ",((r=i.anime().title.ja)==null?null:r.main)||i.anime().title.main," "),s(2),S(" ",i.anime().path," ")}},encapsulation:2,changeDetection:0})}return n})();function Ce(n,u){if(n&1){let e=w();o(0,"app-anime-row",16),c("selected",function(){let i=k(e).$implicit,r=m(2);return T(r.enter(i))}),a()}if(n&2){let e=u.$implicit;v("anime",e)}}function Se(n,u){if(n&1&&(o(0,"ul",11),B(1,Ce,1,1,"app-anime-row",15,N),a()),n&2){let e=m();v("@enterLeaveAnimation",void 0),s(),O(e.titles())}}var ge=(()=>{class n{libraryService;toggleSideNav=new b;enterTitle=new b;openHome=new b;openSettings=new b;searchQuery="";titles=d([]);isOpen=d(!1);constructor(e){this.libraryService=e}onSearch(){if(this.searchQuery.length<=2){this.titles.set([]);return}this.libraryService.search(this.searchQuery).subscribe(e=>this.titles.set(e))}enter(e){this.enterTitle.emit(e),this.searchQuery="",this.titles.set([])}onKeypress(e){let t=this.titles();e.key==="Enter"&&t.length===1&&(e.target.blur(),this.enter(t[0]))}static \u0275fac=function(t){return new(t||n)(_(V))};static \u0275cmp=y({type:n,selectors:[["app-top-bar"]],outputs:{toggleSideNav:"toggleSideNav",enterTitle:"enterTitle",openHome:"openHome",openSettings:"openSettings"},decls:21,vars:2,consts:[[1,"navbar","bg-base-100"],[1,"btn","btn-ghost",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke-width","1.5","stroke","currentColor",1,"size-6"],["stroke-linecap","round","stroke-linejoin","round","d","M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"],["stroke-linecap","round","stroke-linejoin","round","d","m2.25 12 8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25"],["appClickOutside","",1,"flex","flex-col","w-xl",3,"clickOutside"],[1,"input","input-ghost","w-full"],["stroke-linecap","round","stroke-linejoin","round","d","m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"],["id","top-bar-search","type","text","placeholder","Search...","autocomplete","off",3,"ngModelChange","keypress","focus","ngModel"],["open","true",1,"dropdown","dropdown-end"],[1,"hidden"],[1,"dropdown-content","list","rounded-box","bg-base-100","scale-102","mt-3","max-h-[67vh]","w-[67vw]","md:w-full","overflow-y-auto"],[1,"flex-1"],["stroke-linecap","round","stroke-linejoin","round","d","M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.325.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.241-.438.613-.43.992a7.723 7.723 0 0 1 0 .255c-.008.378.137.75.43.991l1.004.827c.424.35.534.955.26 1.43l-1.298 2.247a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.47 6.47 0 0 1-.22.128c-.331.183-.581.495-.644.869l-.213 1.281c-.09.543-.56.94-1.11.94h-2.594c-.55 0-1.019-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 0 1-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 0 1-1.369-.49l-1.297-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.991a6.932 6.932 0 0 1 0-.255c.007-.38-.138-.751-.43-.992l-1.004-.827a1.125 1.125 0 0 1-.26-1.43l1.297-2.247a1.125 1.125 0 0 1 1.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.086.22-.128.332-.183.582-.495.644-.869l.214-1.28Z"],["stroke-linecap","round","stroke-linejoin","round","d","M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"],[3,"anime"],[3,"selected","anime"]],template:function(t,i){t&1&&(o(0,"div",0)(1,"button",1),c("click",function(){return i.toggleSideNav.emit()}),M(),o(2,"svg",2),h(3,"path",3),a()(),D(),o(4,"button",1),c("click",function(){return i.openHome.emit()}),M(),o(5,"svg",2),h(6,"path",4),a(),p(7," Home "),a(),D(),o(8,"div",5),c("clickOutside",function(){return i.isOpen.set(!1)}),o(9,"label",6),M(),o(10,"svg",2),h(11,"path",7),a(),D(),o(12,"input",8),X("ngModelChange",function(l){return J(i.searchQuery,l)||(i.searchQuery=l),l}),c("ngModelChange",function(){return i.onSearch()})("keypress",function(l){return i.onKeypress(l)})("focus",function(){return i.isOpen.set(!0)}),a()(),o(13,"details",9),h(14,"summary",10),C(15,Se,3,1,"ul",11),a()(),h(16,"div",12),o(17,"button",1),c("click",function(){return i.openSettings.emit()}),M(),o(18,"svg",2),h(19,"path",13)(20,"path",14),a()()()),t&2&&(s(12),Y("ngModel",i.searchQuery),s(3),f(i.isOpen()?15:-1))},dependencies:[he,de,ue,_e,fe,ve],encapsulation:2,data:{animation:[L]},changeDetection:0})}return n})();function ke(n,u){if(n&1&&(o(0,"span",12),p(1),a()),n&2){let e=m().$implicit;s(),S(" ",e.info.matched," ")}}function Te(n,u){if(n&1){let e=w();o(0,"li",8)(1,"a",10),c("click",function(){let i=k(e).$implicit,r=m(2);return T(r.goToIndex(i.library.index))}),o(2,"span",11),p(3),a(),C(4,ke,2,1,"span",12),a()()}if(n&2){let e=u.$implicit,t=m(2);s(),I("menu-active",t.index()===e.library.index),s(2),S(" ",e.library.label," "),s(),f(e.info?4:-1)}}function ye(n,u){if(n&1){let e=w();o(0,"li",8)(1,"a",14),c("click",function(){let i=k(e).$implicit,r=m(3);return T(r.goToBookmark(i))}),o(2,"span",11),p(3),a()()()}if(n&2){let e=u.$implicit,t=m(3);s(),I("menu-active",t.bookmark()===e),s(2),S(" ",e.label," ")}}function we(n,u){if(n&1&&(o(0,"li",13),p(1,"Bookmarks"),a(),B(2,ye,4,3,"li",8,N)),n&2){let e=m(2);s(2),O(e.bookmarks())}}function xe(n,u){if(n&1){let e=w();o(0,"li",9)(1,"a",14),c("click",function(){k(e);let i=m(2);return T(i.goToRandomTitle())}),o(2,"span",11),p(3,"Random title"),a()()()}}function Ee(n,u){if(n&1&&(o(0,"ul",4)(1,"li",7),p(2,"Libraries"),a(),B(3,Te,5,4,"li",8,N),C(5,we,4,0)(6,xe,4,0,"li",9),a()),n&2){let e=m();s(3),O(e.libraries()),s(2),f(e.bookmarks().length>0?5:-1),s(),f(e.hasTitle()?6:-1)}}function Me(n,u){if(n&1&&(o(0,"div",6)(1,"div",15)(2,"span"),p(3),a()()()),n&2){let e,t,i,r,l,g=m();v("@enterLeaveAnimation",void 0),s(),I("alert-success",((e=g.toast())==null?null:e.style)==="success")("alert-info",((t=g.toast())==null?null:t.style)==="info")("alert-warning",((i=g.toast())==null?null:i.style)==="warning")("alert-error",((r=g.toast())==null?null:r.style)==="error"),s(2),U((l=g.toast())==null?null:l.message)}}var Ct=(()=>{class n{router;route;bookmarkService;libraryService;eventService;toastService;sideNavOpen=d(!1);showSideNavContent=d(!1);libraries=d([]);hasTitle=d(!1);bookmarks=d([]);bookmark=d(null);index=d(0);toast=d(null);subscriptions=[];ngOnDestroy(){this.subscriptions.forEach(e=>e.unsubscribe())}onNavigationEnd(){let e=this.route.firstChild?.snapshot?.url;e&&(this.refreshBookmarks().subscribe(),this.refreshLibraries().subscribe(t=>{if(e[0].path==="settings"){this.index.set(-1);return}if(e[0].path==="libraries"&&t.length>0){this.index.set(Number(e[1].path));return}this.router.navigate(["settings"])}))}refreshLibraries(){return this.libraryService.getDetails().pipe(E(e=>{this.libraries.set(e),this.hasTitle.set(e.some(({info:t})=>t&&t.matched>0))}))}refreshBookmarks(){return this.bookmarkService.get().pipe(E(e=>this.bookmarks.set(e)))}constructor(e,t,i,r,l,g){this.router=e,this.route=t,this.bookmarkService=i,this.libraryService=r,this.eventService=l,this.toastService=g,this.onNavigationEnd(),this.subscriptions.push(this.router.events.pipe(G(x=>x instanceof te)).subscribe(()=>this.onNavigationEnd())),this.subscriptions.push(this.eventService.on(ce).pipe(H(()=>this.refreshBookmarks())).subscribe()),this.subscriptions.push(this.eventService.on(se).pipe(H(()=>this.refreshLibraries())).subscribe()),this.subscriptions.push(this.eventService.on(me).pipe(E(()=>this.bookmark.set(this.bookmarkService.openedBookmark))).subscribe()),this.subscriptions.push(this.toastService.on().pipe(E(x=>{this.toast.set(x),x.duration>0&&setTimeout(()=>this.toast.set(null),x.duration)})).subscribe())}toggleSideNav(){this.sideNavOpen.update(e=>!e)}goHome(){this.router.navigate([""])}goToSettings(){this.index()!==-1&&this.router.navigate(["settings"])}goToIndex(e){this.index()!==e&&this.router.navigate(["libraries",e])}getLibraryDetail(e){return this.libraries().find(t=>e.startsWith(t.library.path))}goToTitle(e){let t=this.getLibraryDetail(e.path)?.library;if(t){let i=e.path.slice(t.path.length);this.router.navigate(["libraries",t.index,P.FILE.route],{queryParams:{path:i}})}}goToBookmark(e){let t=this.getLibraryDetail(e.path)?.library;if(t){let i=e.path.slice(t.path.length);this.router.navigate(["libraries",t.index,P.FILE.route],{queryParams:{path:i}})}}goToRandomTitle(){this.libraryService.random().subscribe(e=>{e&&this.goToTitle(e)})}onSideNavAnimationStart(e){e.fromState==="visible"&&this.showSideNavContent.set(!1)}onSideNavAnimationEnd(e){e.toState==="visible"&&this.showSideNavContent.set(!0)}static \u0275fac=function(t){return new(t||n)(_(oe),_(ie),_(pe),_(V),_(ae),_(le))};static \u0275cmp=y({type:n,selectors:[["app-main"]],decls:8,vars:3,consts:[[1,"h-dvh","w-dvw","bg-base-100"],[3,"toggleSideNav","openHome","openSettings","enterTitle"],[1,"flex","h-[calc(100dvh-4rem)]"],[1,"h-full","bg-base-100","overflow-y-auto","overflow-x-hidden","absolute","z-1","md:relative","md:z-0"],[1,"menu","w-full"],[1,"h-full","w-full","ml-4"],[1,"toast"],[1,"menu-title","w-full"],[1,"w-full"],[1,"w-full","mt-7"],["aria-hidden","true",1,"flex","items-center","gap-4","py-3",3,"click"],[1,"flex-1","break-all"],[1,"badge","badge-primary","badge-sm"],[1,"menu-title","w-full","mt-7"],["aria-hidden","true",1,"flex","items-center","py-3",3,"click"],[1,"alert","alert-soft"]],template:function(t,i){t&1&&(o(0,"div",0)(1,"app-top-bar",1),c("toggleSideNav",function(){return i.toggleSideNav()})("openHome",function(){return i.goHome()})("openSettings",function(){return i.goToSettings()})("enterTitle",function(l){return i.goToTitle(l)}),a(),o(2,"div",2)(3,"div",3),c("@sideNavAnimation.start",function(l){return i.onSideNavAnimationStart(l)})("@sideNavAnimation.done",function(l){return i.onSideNavAnimationEnd(l)}),C(4,Ee,7,2,"ul",4),a(),o(5,"div",5),h(6,"router-outlet"),a()()(),C(7,Me,4,10,"div",6)),t&2&&(s(3),v("@sideNavAnimation",i.sideNavOpen()?"visible":"hidden"),s(),f(i.showSideNavContent()?4:-1),s(3),f(i.toast()?7:-1))},dependencies:[re,ne,ge],encapsulation:2,data:{animation:[L,ee("sideNavAnimation",[j("visible",A({width:"300px"})),j("hidden",A({width:0})),F("visible => hidden",R("233ms ease-out",A({width:0}))),F("hidden => visible",R("233ms ease-in",A({width:"300px"})))])]},changeDetection:0})}return n})();export{Ct as MainComponent};
