import{F as C,s as d}from"./chunk-T4XCOYID.js";import{$ as p,A as u,B as m,Ga as v,I as g,J as b,O as S,Q as o,S as y,T as s,W as c,i as h,o as l,t as f}from"./chunk-X3KZUPYP.js";var D=(()=>{class e{subject=new h;event=this.subject.asObservable();emit(t){this.subject.next(t)}on(t){return this.event.pipe(m(r=>r===t))}once(t){return this.event.pipe(b(r=>r===t))}static \u0275fac=function(r){return new(r||e)};static \u0275prov=c({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function I(e){let i=null;return()=>(i===null&&(i=e().pipe(S(1),g(()=>i=null))),i)}function R(e){return typeof e=="function"?e:i=>i[e]}function L(e,i,t){let r=R(t.by),n=r(e),a=r(i);return n===a?typeof t.fallback=="function"?t.fallback():0:typeof n=="number"&&typeof a=="number"?n-a:String(n).localeCompare(String(a))}function T(e){e._doChangeDetection=()=>{e._isDestroyed||e.ngZone.run(()=>{e._changeDetectorRef.markForCheck(),v(()=>{e._contentWrapper.nativeElement.style.transform=e._renderedContentTransform,e._isChangeDetectionPending=!1;let i=e._runAfterChangeDetection;e._runAfterChangeDetection=[];for(let t of i)t()},{injector:e._injector})})}}var N="LIBRARY_CHANGED",j="SCAN_FINISHED",O=(()=>{class e{http;configService;eventService;libraries=null;constructor(t,r,n){this.http=t,this.configService=r,this.eventService=n}search(t){return this.http.post("/api/library/search",{query:t})}getLibraryDetails=I(()=>this.http.get("/api/library/details").pipe(s(t=>this.libraries=t)));setLibraries(t){return this.configService.setConfig({key:"LIBRARY",config:{libraries:t}}).pipe(s(()=>this.refreshTitles()),o(()=>this.getLibraryDetails()),s(()=>this.eventService.emit(N)))}getDetail(t){return this.getDetails().pipe(f(r=>r[t]))}getDetails(){return this.libraries===null?this.getLibraryDetails():l(this.libraries)}getTitle(t){return this.http.post("/api/library/title",{path:t})}getTitles(t){return this.http.post("/api/library/titles",{path:t})}random(){return this.http.get("/api/library/titles/random")}getOverMatchedTitles(t){return this.http.post("/api/library/titles/overmatched",{path:t})}refreshTitles(){return this.http.get("/api/library/titles/refresh")}scan(t){return this.http.post("/api/library/scan",{path:t})}setScanningConfig(t){return this.http.post("/api/library/scanning/config",t)}checkScanningStatus(t){return this.http.post("/api/library/scanning/status",{path:t})}onScanFinished(t){return u(233).pipe(o(()=>this.checkScanningStatus(t)),o(({status:r})=>r==="SCANNING"?l(r):this.getLibraryDetails().pipe(s(()=>this.eventService.emit(N)),s(()=>this.eventService.emit(j)),f(()=>r))),y(r=>r==="SCANNING")).subscribe(),this.eventService.once(j)}static \u0275fac=function(r){return new(r||e)(p(d),p(C),p(D))};static \u0275prov=c({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();export{D as a,I as b,L as c,T as d,N as e,O as f};
