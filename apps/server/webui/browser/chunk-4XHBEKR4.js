import{a as se}from"./chunk-IL6FGR6O.js";import{b as I}from"./chunk-RFR63KKH.js";import{c as ee,d as R,f as A,g as j,h as F}from"./chunk-3QIFBVMG.js";import{b as ce,c as me}from"./chunk-D2CL3KRH.js";import{a as ae,c as le,d as L}from"./chunk-C6P4MNK7.js";import{c as te,d as ie,e as ne,f as oe,i as re}from"./chunk-LEP5KRIK.js";import{a as pe,c as de,f as ue,l as _e}from"./chunk-XYKVWS4A.js";import{z as Q}from"./chunk-VO7SG4EQ.js";import{B as P,Cb as m,Db as U,Eb as S,Gb as Y,Hb as J,Ia as W,Ib as X,Ja as q,Ka as l,Pa as _,Q as V,T as D,Va as y,Xa as Z,_a as C,fb as f,hb as H,ia as k,ib as v,ja as T,jb as M,ka as E,kb as N,la as O,lb as B,mb as o,nb as a,ob as h,pb as w,ra as b,sb as c,tb as p,ua as $,va as z,wa as K,xa as u}from"./chunk-ETUXU3TJ.js";var he=(()=>{class n{ref;clickOutside=$();constructor(e){this.ref=e}onClick(e){this.ref.nativeElement.contains(e)||this.clickOutside.emit()}static \u0275fac=function(i){return new(i||n)(_(K))};static \u0275dir=Z({type:n,selectors:[["","appClickOutside",""]],hostBindings:function(i,t){i&1&&c("click",function(s){return t.onClick(s.target)},!1,q)},outputs:{clickOutside:"clickOutside"}})}return n})();var fe=(()=>{class n{selected=new b;anime=z.required();static \u0275fac=function(i){return new(i||n)};static \u0275cmp=y({type:n,selectors:[["app-anime-row"]],inputs:{anime:[1,"anime"]},outputs:{selected:"selected"},decls:9,vars:4,consts:[["aria-hidden","true",1,"list-row","cursor-pointer","hover:bg-base-300",3,"click"],[1,"flex","items-center","justify-center","h-23","w-23"],["aria-hidden","true",1,"rounded-xl","object-cover","h-23","w-23","cursor-pointer",3,"click","src","alt"],[1,"font-semibold"],[1,"text-lg"],[1,"text-xs","opacity-50"]],template:function(i,t){if(i&1&&(o(0,"li",0),c("click",function(){return t.selected.emit()}),o(1,"div",1)(2,"figure")(3,"img",2),c("click",function(){return t.selected.emit()}),a()()(),o(4,"div",3)(5,"div",4),m(6),a(),o(7,"div",5),m(8),a()()()),i&2){let r;l(3),f("src","/api/content/image/"+t.anime().title.aid,W)("alt",t.anime().title.main||t.anime().title.aid),l(3),S(" ",((r=t.anime().title.ja)==null?null:r.main)||t.anime().title.main," "),l(2),S(" ",t.anime().path," ")}},encapsulation:2,changeDetection:0})}return n})();function be(n,d){if(n&1){let e=w();o(0,"app-anime-row",16),c("selected",function(){let t=k(e).$implicit,r=p(2);return T(r.enter(t))}),a()}if(n&2){let e=d.$implicit;f("anime",e)}}function Ce(n,d){if(n&1&&(o(0,"ul",11),N(1,be,1,1,"app-anime-row",15,M),a()),n&2){let e=p();f("@enterLeaveAnimation",void 0),l(),B(e.titles())}}var ve=(()=>{class n{libraryService;toggleSideNav=new b;enterTitle=new b;openHome=new b;openSettings=new b;searchQuery="";titles=u([]);isOpen=u(!1);constructor(e){this.libraryService=e}onSearch(){if(this.searchQuery.length<=2){this.titles.set([]);return}this.libraryService.search(this.searchQuery).subscribe(e=>this.titles.set(e))}enter(e){this.enterTitle.emit(e),this.searchQuery="",this.titles.set([])}onKeypress(e){let i=this.titles();e.key==="Enter"&&i.length===1&&(e.target.blur(),this.enter(i[0]))}static \u0275fac=function(i){return new(i||n)(_(L))};static \u0275cmp=y({type:n,selectors:[["app-top-bar"]],outputs:{toggleSideNav:"toggleSideNav",enterTitle:"enterTitle",openHome:"openHome",openSettings:"openSettings"},decls:21,vars:2,consts:[[1,"navbar","bg-base-100"],[1,"btn","btn-ghost",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke-width","1.5","stroke","currentColor",1,"size-6"],["stroke-linecap","round","stroke-linejoin","round","d","M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"],["stroke-linecap","round","stroke-linejoin","round","d","m2.25 12 8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25"],["appClickOutside","",1,"flex","flex-col","w-xl",3,"clickOutside"],[1,"input","input-ghost","w-full"],["stroke-linecap","round","stroke-linejoin","round","d","m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"],["id","top-bar-search","type","text","placeholder","Search...","autocomplete","off",3,"ngModelChange","keypress","focus","ngModel"],["open","true",1,"dropdown","dropdown-end"],[1,"hidden"],[1,"dropdown-content","list","rounded-box","bg-base-100","scale-102","mt-3","max-h-[67vh]","w-[67vw]","md:w-full","overflow-y-auto"],[1,"flex-1"],["stroke-linecap","round","stroke-linejoin","round","d","M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.325.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.241-.438.613-.43.992a7.723 7.723 0 0 1 0 .255c-.008.378.137.75.43.991l1.004.827c.424.35.534.955.26 1.43l-1.298 2.247a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.47 6.47 0 0 1-.22.128c-.331.183-.581.495-.644.869l-.213 1.281c-.09.543-.56.94-1.11.94h-2.594c-.55 0-1.019-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 0 1-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 0 1-1.369-.49l-1.297-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.991a6.932 6.932 0 0 1 0-.255c.007-.38-.138-.751-.43-.992l-1.004-.827a1.125 1.125 0 0 1-.26-1.43l1.297-2.247a1.125 1.125 0 0 1 1.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.086.22-.128.332-.183.582-.495.644-.869l.214-1.28Z"],["stroke-linecap","round","stroke-linejoin","round","d","M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"],[3,"anime"],[3,"selected","anime"]],template:function(i,t){i&1&&(o(0,"div",0)(1,"button",1),c("click",function(){return t.toggleSideNav.emit()}),E(),o(2,"svg",2),h(3,"path",3),a()(),O(),o(4,"button",1),c("click",function(){return t.openHome.emit()}),E(),o(5,"svg",2),h(6,"path",4),a(),m(7," Home "),a(),O(),o(8,"div",5),c("clickOutside",function(){return t.isOpen.set(!1)}),o(9,"label",6),E(),o(10,"svg",2),h(11,"path",7),a(),O(),o(12,"input",8),X("ngModelChange",function(s){return J(t.searchQuery,s)||(t.searchQuery=s),s}),c("ngModelChange",function(){return t.onSearch()})("keypress",function(s){return t.onKeypress(s)})("focus",function(){return t.isOpen.set(!0)}),a()(),o(13,"details",9),h(14,"summary",10),C(15,Ce,3,1,"ul",11),a()(),h(16,"div",12),o(17,"button",1),c("click",function(){return t.openSettings.emit()}),E(),o(18,"svg",2),h(19,"path",13)(20,"path",14),a()()()),i&2&&(l(12),Y("ngModel",t.searchQuery),l(3),v(t.isOpen()?15:-1))},dependencies:[_e,pe,de,ue,fe,he],encapsulation:2,data:{animation:[I]},changeDetection:0})}return n})();function Se(n,d){if(n&1&&(o(0,"span",12),m(1),a()),n&2){let e=p().$implicit;l(),S(" ",e.info.matched," ")}}function ke(n,d){if(n&1){let e=w();o(0,"li",8)(1,"a",10),c("click",function(){let t=k(e).$implicit,r=p(2);return T(r.goToIndex(t.library.index))}),o(2,"span",11),m(3),a(),C(4,Se,2,1,"span",12),a()()}if(n&2){let e=d.$implicit,i=p(2);l(),H("menu-active",i.index()===e.library.index),l(2),S(" ",e.library.label," "),l(),v(e.info?4:-1)}}function Te(n,d){if(n&1){let e=w();o(0,"li",8)(1,"a",14),c("click",function(){let t=k(e).$implicit,r=p(3);return T(r.goToBookmark(t))}),o(2,"span",11),m(3),a()()()}if(n&2){let e=d.$implicit;l(3),S(" ",e.label," ")}}function ye(n,d){if(n&1&&(o(0,"li",13),m(1,"Bookmarks"),a(),N(2,Te,4,1,"li",8,M)),n&2){let e=p(2);l(2),B(e.bookmarks())}}function we(n,d){if(n&1){let e=w();o(0,"li",9)(1,"a",14),c("click",function(){k(e);let t=p(2);return T(t.goToRandomTitle())}),o(2,"span",11),m(3,"Random title"),a()()()}}function xe(n,d){if(n&1&&(o(0,"ul",4)(1,"li",7),m(2,"Libraries"),a(),N(3,ke,5,4,"li",8,M),C(5,ye,4,0)(6,we,4,0,"li",9),a()),n&2){let e=p();l(3),B(e.libraries()),l(2),v(e.bookmarks().length>0?5:-1),l(),v(e.hasTitle()?6:-1)}}function Ee(n,d){if(n&1&&(o(0,"div",6)(1,"div",15)(2,"span"),m(3),a()()()),n&2){let e,i,t,r,s,g=p();f("@enterLeaveAnimation",void 0),l(),H("alert-success",((e=g.toast())==null?null:e.style)==="success")("alert-info",((i=g.toast())==null?null:i.style)==="info")("alert-warning",((t=g.toast())==null?null:t.style)==="warning")("alert-error",((r=g.toast())==null?null:r.style)==="error"),l(2),U((s=g.toast())==null?null:s.message)}}var bt=(()=>{class n{router;route;bookmarkService;libraryService;eventService;toastService;sideNavOpen=u(!1);showSideNavContent=u(!1);libraries=u([]);hasTitle=u(!1);bookmarks=u([]);index=u(0);toast=u(null);subscriptions=[];ngOnDestroy(){this.subscriptions.forEach(e=>e.unsubscribe())}onNavigationEnd(){let e=this.route.firstChild?.snapshot?.url;e&&(this.refreshBookmarks().subscribe(),this.refreshLibraries().subscribe(i=>{if(e[0].path==="settings"){this.index.set(-1);return}if(e[0].path==="libraries"&&i.length>0){this.index.set(Number(e[1].path));return}this.router.navigate(["settings"])}))}refreshLibraries(){return this.libraryService.getDetails().pipe(D(e=>{this.libraries.set(e),this.hasTitle.set(e.some(({info:i})=>i&&i.matched>0))}))}refreshBookmarks(){return this.bookmarkService.get().pipe(D(e=>this.bookmarks.set(e)))}constructor(e,i,t,r,s,g){this.router=e,this.route=i,this.bookmarkService=t,this.libraryService=r,this.eventService=s,this.toastService=g,this.onNavigationEnd(),this.subscriptions.push(this.router.events.pipe(P(x=>x instanceof te)).subscribe(()=>this.onNavigationEnd())),this.subscriptions.push(this.eventService.on(ce).pipe(V(()=>this.refreshBookmarks())).subscribe()),this.subscriptions.push(this.eventService.on(le).pipe(V(()=>this.refreshLibraries())).subscribe()),this.subscriptions.push(this.toastService.on().pipe(D(x=>{this.toast.set(x),x.duration>0&&setTimeout(()=>this.toast.set(null),x.duration)})).subscribe())}toggleSideNav(){this.sideNavOpen.update(e=>!e)}goHome(){this.router.navigate([""])}goToSettings(){this.index()!==-1&&this.router.navigate(["settings"])}goToIndex(e){this.index()!==e&&this.router.navigate(["libraries",e])}getLibraryDetail(e){return this.libraries().find(i=>e.startsWith(i.library.path))}goToTitle(e){let i=this.getLibraryDetail(e.path)?.library;if(i){let t=e.path.slice(i.path.length);this.router.navigate(["libraries",i.index,Q.FILE.route],{queryParams:{path:t}})}}goToBookmark(e){let i=this.getLibraryDetail(e.path)?.library;if(i){let t=e.path.slice(i.path.length);this.router.navigate(["libraries",i.index,Q.FILE.route],{queryParams:{path:t}})}}goToRandomTitle(){this.libraryService.random().subscribe(e=>{e&&this.goToTitle(e)})}onSideNavAnimationStart(e){e.fromState==="visible"&&this.showSideNavContent.set(!1)}onSideNavAnimationEnd(e){e.toState==="visible"&&this.showSideNavContent.set(!0)}static \u0275fac=function(i){return new(i||n)(_(oe),_(ie),_(me),_(L),_(ae),_(se))};static \u0275cmp=y({type:n,selectors:[["app-main"]],decls:8,vars:3,consts:[[1,"h-dvh","w-dvw","bg-base-100"],[3,"toggleSideNav","openHome","openSettings","enterTitle"],[1,"flex","h-[calc(100dvh-4rem)]"],[1,"h-full","bg-base-100","overflow-y-auto","overflow-x-hidden","absolute","z-1","md:relative","md:z-0"],[1,"menu","w-full"],[1,"h-full","w-full","ml-4"],[1,"toast"],[1,"menu-title","w-full"],[1,"w-full"],[1,"w-full","mt-7"],["aria-hidden","true",1,"flex","items-center","gap-4","py-3",3,"click"],[1,"flex-1","break-all"],[1,"badge","badge-primary","badge-sm"],[1,"menu-title","w-full","mt-7"],["aria-hidden","true",1,"flex","items-center","py-3",3,"click"],[1,"alert","alert-soft"]],template:function(i,t){i&1&&(o(0,"div",0)(1,"app-top-bar",1),c("toggleSideNav",function(){return t.toggleSideNav()})("openHome",function(){return t.goHome()})("openSettings",function(){return t.goToSettings()})("enterTitle",function(s){return t.goToTitle(s)}),a(),o(2,"div",2)(3,"div",3),c("@sideNavAnimation.start",function(s){return t.onSideNavAnimationStart(s)})("@sideNavAnimation.done",function(s){return t.onSideNavAnimationEnd(s)}),C(4,xe,7,2,"ul",4),a(),o(5,"div",5),h(6,"router-outlet"),a()()(),C(7,Ee,4,10,"div",6)),i&2&&(l(3),f("@sideNavAnimation",t.sideNavOpen()?"visible":"hidden"),l(),v(t.showSideNavContent()?4:-1),l(3),v(t.toast()?7:-1))},dependencies:[re,ne,ve],encapsulation:2,data:{animation:[I,ee("sideNavAnimation",[j("visible",A({width:"300px"})),j("hidden",A({width:0})),F("visible => hidden",R("233ms ease-out",A({width:0}))),F("hidden => visible",R("233ms ease-in",A({width:"300px"})))])]},changeDetection:0})}return n})();export{bt as MainComponent};
