import{F as d,s as y}from"./chunk-VUNKUA53.js";import{$ as c,A as u,B as m,I as b,J as v,O as g,Q as o,S,T as s,W as p,i as f,o as l,t as h}from"./chunk-S4OIF5WA.js";var I=(()=>{class i{subject=new f;event=this.subject.asObservable();emit(t){this.subject.next(t)}on(t){return this.event.pipe(m(e=>e===t))}once(t){return this.event.pipe(v(e=>e===t))}static \u0275fac=function(e){return new(e||i)};static \u0275prov=p({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();function N(i){let r=null;return()=>(r===null&&(r=i().pipe(g(1),b(()=>r=null))),r)}function A(i){return typeof i=="function"?i:r=>r[i]}function L(i,r,t){let e=A(t.by),n=e(i),a=e(r);return n===a?typeof t.fallback=="function"?t.fallback():0:typeof n=="number"&&typeof a=="number"?n-a:String(n).localeCompare(String(a))}var C="LIBRARY_CHANGED",j="SCAN_FINISHED",M=(()=>{class i{http;configService;eventService;libraries=null;constructor(t,e,n){this.http=t,this.configService=e,this.eventService=n}search(t){return this.http.post("/api/library/search",{query:t})}getLibraryDetails=N(()=>this.http.get("/api/library/details").pipe(s(t=>this.libraries=t)));setLibraries(t){return this.configService.setConfig({key:"LIBRARY",config:{libraries:t}}).pipe(s(()=>this.refreshTitles()),o(()=>this.getLibraryDetails()),s(()=>this.eventService.emit(C)))}getDetail(t){return this.getDetails().pipe(h(e=>e[t]))}getDetails(){return this.libraries===null?this.getLibraryDetails():l(this.libraries)}getTitle(t){return this.http.post("/api/library/title",{path:t})}getTitles(t){return this.http.post("/api/library/titles",{path:t})}random(){return this.http.get("/api/library/titles/random")}getOverMatchedTitles(t){return this.http.post("/api/library/titles/overmatched",{path:t})}refreshTitles(){return this.http.get("/api/library/titles/refresh")}scan(t){return this.http.post("/api/library/scan",{path:t})}setScanningConfig(t){return this.http.post("/api/library/scanning/config",t)}checkScanningStatus(t){return this.http.post("/api/library/scanning/status",{path:t})}onScanFinished(t){return u(233).pipe(o(()=>this.checkScanningStatus(t)),o(({status:e})=>e==="SCANNING"?l(e):this.getLibraryDetails().pipe(s(()=>this.eventService.emit(C)),s(()=>this.eventService.emit(j)),h(()=>e))),S(e=>e==="SCANNING")).subscribe(),this.eventService.once(j)}static \u0275fac=function(e){return new(e||i)(c(y),c(d),c(I))};static \u0275prov=p({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();export{I as a,N as b,L as c,C as d,M as e};
