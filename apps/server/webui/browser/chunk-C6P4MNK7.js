import{F as S,s as g}from"./chunk-VO7SG4EQ.js";import{$ as o,A as h,B as f,I as u,J as m,O as v,Q as s,S as b,T as r,W as a,i as l,o as p,t as c}from"./chunk-ETUXU3TJ.js";var y=(()=>{class i{subject=new l;event=this.subject.asObservable();emit(t){this.subject.next(t)}on(t){return this.event.pipe(f(e=>e===t))}once(t){return this.event.pipe(m(e=>e===t))}static \u0275fac=function(e){return new(e||i)};static \u0275prov=a({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();function d(i){let n=null;return()=>(n===null&&(n=i().pipe(v(1),u(()=>n=null))),n)}var I="LIBRARY_CHANGED",N="SCAN_FINISHED",B=(()=>{class i{http;configService;eventService;libraries=null;constructor(t,e,C){this.http=t,this.configService=e,this.eventService=C}search(t){return this.http.post("/api/library/search",{query:t})}getLibraryDetails=d(()=>this.http.get("/api/library/details").pipe(r(t=>this.libraries=t)));setLibraries(t){return this.configService.setConfig({key:"LIBRARY",config:{libraries:t}}).pipe(r(()=>this.refreshTitles()),s(()=>this.getLibraryDetails()),r(()=>this.eventService.emit(I)))}getDetail(t){return this.getDetails().pipe(c(e=>e[t]))}getDetails(){return this.libraries===null?this.getLibraryDetails():p(this.libraries)}getTitle(t){return this.http.post("/api/library/title",{path:t})}getTitles(t){return this.http.post("/api/library/titles",{path:t})}random(){return this.http.get("/api/library/titles/random")}getOverMatchedTitles(t){return this.http.post("/api/library/titles/overmatched",{path:t})}refreshTitles(){return this.http.get("/api/library/titles/refresh")}scan(t){return this.http.post("/api/library/scan",{path:t})}setScanningConfig(t){return this.http.post("/api/library/scanning/config",t)}checkScanningStatus(t){return this.http.post("/api/library/scanning/status",{path:t})}onScanFinished(t){return h(233).pipe(s(()=>this.checkScanningStatus(t)),s(({status:e})=>e==="SCANNING"?p(e):this.getLibraryDetails().pipe(r(()=>this.eventService.emit(I)),r(()=>this.eventService.emit(N)),c(()=>e))),b(e=>e==="SCANNING")).subscribe(),this.eventService.once(N)}static \u0275fac=function(e){return new(e||i)(o(g),o(S),o(y))};static \u0275prov=a({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();export{y as a,d as b,I as c,B as d};
