import{f as M}from"./chunk-OJQVR5OV.js";import{a as T,b as f,c as k,d as G,g as U,i as q,j as A,k as P,m as R}from"./chunk-FSH6E5MA.js";import{F as D,a as _,j,l as E,s as L,v as N}from"./chunk-VUNKUA53.js";import{$ as p,Cb as a,Db as F,Ka as m,Pa as d,T as S,Va as C,W as w,_a as c,fb as s,mb as n,nb as r,o as b,ob as h,sb as I,t as g,tb as x,xa as y}from"./chunk-S4OIF5WA.js";var V=(()=>{class i{document;http;config;localStorage;constructor(t,o,e,l){this.document=t,this.http=o,this.config=e,this.localStorage=l}login(t,o){return this.http.post("/api/auth/login",{name:t,hash:o}).pipe(S(({token:e})=>{e&&(this.localStorage.setItem("token",e),this.document.cookie=`pan_webui=${e}; Path=/`,this.config.loadUIConfig())}),g(({token:e})=>e!==void 0))}verify(){let t=this.localStorage.getItem("token");return!t||t.length===0?b(!1):this.http.post("/api/auth/verify",{token:t}).pipe(g(({authorized:o})=>(o||this.localStorage.removeItem("token"),o)))}static \u0275fac=function(o){return new(o||i)(p(_),p(L),p(D),p(N))};static \u0275prov=w({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();function O(i,v){i&1&&(n(0,"div",15)(1,"span",16),a(2,"Username is required."),r()())}function $(i,v){i&1&&(n(0,"div",15)(1,"span",16),a(2,"Password must be at least 4 characters."),r()())}function J(i,v){if(i&1&&(n(0,"div",17)(1,"div",18),a(2),r()()),i&2){let t=x();m(2),F(t.errorMessage())}}var ce=(()=>{class i{fb;auth;router;loginForm;errorMessage=y("");constructor(t,o,e){this.fb=t,this.auth=o,this.router=e,this.loginForm=this.fb.group({name:["",[f.required]],password:["",[f.required,f.minLength(4)]]})}ngOnInit(){this.auth.verify().subscribe(t=>{t&&this.router.navigate([""])}),this.loginForm.valueChanges.subscribe(()=>{this.errorMessage.set("")})}onSubmit(){if(this.loginForm.invalid)return;let{name:t,password:o}=this.loginForm.value;this.auth.login(t,o).subscribe(e=>{e?this.router.navigate([""]):this.errorMessage.set("Invalid credentials!")})}static \u0275fac=function(o){return new(o||i)(d(P),d(V),d(M))};static \u0275cmp=C({type:i,selectors:[["app-login"]],decls:20,vars:5,consts:[[1,"h-dvh","w-dvw","bg-base-200","flex","items-center","justify-center"],[1,"card","w-full","max-w-md","bg-base-100","shadow-xl"],[1,"card-body"],[1,"card-title","text-2xl","justify-center"],[3,"ngSubmit","formGroup"],[1,"w-full"],["for","name",1,"label"],["id","name","type","text","autocomplete","username","formControlName","name","placeholder","Enter your username",1,"input","mt-2","w-full"],["class","label mt-2",4,"ngIf"],[1,"w-full","mt-4"],["for","password",1,"label"],["id","password","type","password","autocomplete","current-password","formControlName","password","placeholder","Enter your password",1,"input","mt-2","w-full"],["class","mt-4",4,"ngIf"],[1,"mt-6"],["type","submit",1,"btn","btn-primary","w-full",3,"disabled"],[1,"label","mt-2"],[1,"text-error"],[1,"mt-4"],[1,"text-error","text-center","text-sm"]],template:function(o,e){if(o&1&&(n(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2",3),a(4,"Login"),r(),n(5,"form",4),I("ngSubmit",function(){return e.onSubmit()}),n(6,"div",5)(7,"label",6),a(8,"Username"),r(),h(9,"input",7),c(10,O,3,0,"div",8),r(),n(11,"div",9)(12,"label",10),a(13,"Password"),r(),h(14,"input",11),c(15,$,3,0,"div",8),r(),c(16,J,3,1,"div",12),n(17,"div",13)(18,"button",14),a(19," Login "),r()()()()()()),o&2){let l,u;m(5),s("formGroup",e.loginForm),m(5),s("ngIf",((l=e.loginForm.get("name"))==null?null:l.invalid)&&((l=e.loginForm.get("name"))==null?null:l.touched)),m(5),s("ngIf",((u=e.loginForm.get("password"))==null?null:u.invalid)&&((u=e.loginForm.get("password"))==null?null:u.touched)),m(),s("ngIf",e.errorMessage().length>0),m(2),s("disabled",e.loginForm.invalid)}},dependencies:[E,j,R,U,T,k,G,q,A],encapsulation:2,changeDetection:0})}return i})();export{ce as LoginComponent};
