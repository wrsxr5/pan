import{a as k,b as u}from"./chunk-EZ4CD3YJ.js";import{F as l}from"./chunk-T4XCOYID.js";import{$ as n,B as p,Q as f,T as s,W as r,i as a,o as h,t as m}from"./chunk-X3KZUPYP.js";var d="BOOKMARK_CHANGED",O="BOOKMARK_OPENED",y=(()=>{class o{configService;eventService;CONFIG_KEY="BOOKMARK";bookmarks=null;openedBookmark=null;constructor(t,e){this.configService=t,this.eventService=e}getConfig=u(()=>this.configService.getConfig(this.CONFIG_KEY).pipe(m(t=>t?.bookmarks||[]),s(t=>this.bookmarks=t)));get(){return this.bookmarks===null?this.getConfig():h(this.bookmarks)}setConfig(){return this.bookmarks===null?this.getConfig():this.configService.setConfig({key:this.CONFIG_KEY,config:{bookmarks:this.bookmarks}}).pipe(f(()=>this.getConfig()),s(()=>this.eventService.emit(d)))}add(t){this.bookmarks===null||this.bookmarks.some(e=>e.path===t.path)||(this.bookmarks.push(t),this.setConfig().subscribe())}remove(t){this.bookmarks===null||!this.bookmarks.some(e=>e.path===t.path)||(this.bookmarks=this.bookmarks.filter(e=>e.path!==t.path),this.setConfig().subscribe())}setOpenedBookmark(t){this.openedBookmark=t,this.eventService.emit(O)}static \u0275fac=function(e){return new(e||o)(n(l),n(k))};static \u0275prov=r({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})();var R=(()=>{class o{socket=null;subject=new a;event=this.subject.asObservable();ngOnDestroy(){this.socket?.close(),this.subject.complete()}on(t){return this.event.pipe(p(e=>e.topic===t))}constructor(){let{protocol:t,hostname:e,port:c}=window.location,b=`${t==="https:"?"wss:":"ws:"}//${e}${c?`:${c}`:""}/ws`;this.socket=new WebSocket(b),this.socket.addEventListener("message",i=>{try{this.subject.next(JSON.parse(i.data))}catch(v){console.error(v)}}),this.socket.addEventListener("error",i=>{this.subject.error(i)}),this.socket.addEventListener("close",()=>{this.subject.complete()})}static \u0275fac=function(e){return new(e||o)};static \u0275prov=r({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})();export{R as a,d as b,O as c,y as d};
