import{a as he,b as be,c as ve,e as Ce}from"./chunk-7HSRKZAP.js";import{c as Ee}from"./chunk-VAI5ABIM.js";import{a as Ve,d as Me}from"./chunk-KOMMF4BV.js";import{d as ke,f as Z}from"./chunk-EZ4CD3YJ.js";import{a as j,b as R,c as B,d as G,e as K,f as X,g as O,h as Te,i as ee,j as te,k as ie,l as ne,m as oe}from"./chunk-K6FZPC3A.js";import{D as we,F as ye,a as _e,k as J,s as fe,x as Se,y as xe}from"./chunk-T4XCOYID.js";import{$ as me,Ab as Y,Bb as L,Cb as s,Db as N,Eb as C,Gb as A,Hb as I,Ia as pe,Ib as F,Ka as l,Kb as W,Lb as le,Mb as Q,Pa as x,Q as ae,Sa as U,T as $,Va as V,W as z,Ya as ge,_a as y,eb as ue,fb as f,hb as D,i as ce,ia as d,ib as w,ja as m,jb as M,ka as h,kb as E,la as S,lb as T,mb as n,nb as o,ob as _,pb as v,ra as H,sb as p,t as de,tb as g,xa as b,zb as q}from"./chunk-X3KZUPYP.js";var Le=(()=>{class a{transform(e){return!e||typeof e!="object"?0:Object.keys(e).length}static \u0275fac=function(i){return new(i||a)};static \u0275pipe=ge({name:"count",type:a,pure:!0})}return a})();var re=(()=>{class a{subject=new ce;event=this.subject.asObservable();showDialog(e,i){this.subject.next({detail:e,tab:i})}on(){return this.event}static \u0275fac=function(i){return new(i||a)};static \u0275prov=z({token:a,factory:a.\u0275fac,providedIn:"root"})}return a})();function Re(a,u){if(a&1){let e=v();n(0,"div",9)(1,"label",27),s(2," File "),o(),n(3,"input",28),p("change",function(t){d(e);let r=g();return m(r.onFileSelected(t))}),o()()}}var Ie=(()=>{class a{result=new H;actionType=b("CLIENT");filename="";file="";isValidFile=b(!1);selectedTitle=b(!1);library=b(!1);libraryInfo=b(!1);libraryTitles=b(!1);form;constructor(e){this.form=e.group({name:["",[R.required,R.minLength(2)]]})}resetFile(){this.filename="",this.file="",this.isValidFile.set(!1)}onFileSelected(e){if(this.resetFile(),!e.target)return;let i=e.target;if(!i.files||i.files.length===0)return;let t=i.files[0];this.filename=t.name;let r=new FileReader;r.onload=c=>{c.target&&c.target.result&&(this.file=c.target.result,this.isValidFile.set(this.filename.length>0&&this.file.length>0))},r.readAsText(t)}cancel(){this.result.emit(null),this.resetFile()}submit(){this.actionType()==="CLIENT"?this.result.emit({name:this.form.value.name,type:"CLIENT",selectedTitle:this.selectedTitle(),library:this.library(),libraryInfo:this.libraryInfo(),libraryTitles:this.libraryTitles()}):this.actionType()==="SERVER"&&this.result.emit({name:this.form.value.name,type:"SERVER",selectedTitle:this.selectedTitle(),library:this.library(),libraryInfo:this.libraryInfo(),libraryTitles:this.libraryTitles(),file:this.file,filename:this.filename}),this.resetFile()}static \u0275fac=function(i){return new(i||a)(x(ie))};static \u0275cmp=V({type:a,selectors:[["app-action-modal"]],outputs:{result:"result"},decls:53,vars:9,consts:[["dialog",""],[1,"btn","btn-sm","btn-primary",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke-width","1.5","stroke","currentColor",1,"size-5"],["stroke-linecap","round","stroke-linejoin","round","d","M12 4.5v15m7.5-7.5h-15"],[1,"modal"],[1,"modal-box"],[1,"text-lg","font-bold"],["method","dialog",3,"formGroup"],[1,"my-7"],[1,"flex","flex-col","mb-3"],[1,"label","text-lg","font-semibold","mb-2"],[1,"grid","grid-cols-1","lg:grid-cols-2","gap-2"],[1,"label","cursor-pointer"],["type","radio","name","action-type-client",1,"radio",3,"click","checked"],[1,"ml-1"],["type","radio","name","action-type-server",1,"radio",3,"click","checked"],[1,"mb-3"],["for","action-modal-name",1,"label","text-lg","font-semibold","mb-2"],["id","action-modal-name","type","text","placeholder","Enter the action name","formControlName","name",1,"input","w-full"],[1,"mb-11"],["type","checkbox","name","action-context-selected-title",1,"checkbox",3,"click","checked"],["type","checkbox","name","action-context-library",1,"checkbox",3,"click","checked"],["type","checkbox","name","action-context-library-info",1,"checkbox",3,"click","checked"],["type","checkbox","name","action-context-library-titles",1,"checkbox",3,"click","checked"],[1,"modal-action"],[1,"btn","btn-secondary",3,"click"],["type","submit",1,"btn","btn-primary","ml-5",3,"click","disabled"],["for","action-file",1,"label","text-lg","font-semibold","mb-2"],["id","action-file","type","file",1,"file-input",3,"change"]],template:function(i,t){if(i&1){let r=v();n(0,"button",1),p("click",function(){d(r);let k=L(5);return m(k.showModal())}),h(),n(1,"svg",2),_(2,"path",3),o(),s(3,` Add an action
`),o(),S(),n(4,"dialog",4,0)(6,"div",5)(7,"h2",6),s(8,"Add an action"),o(),n(9,"form",7)(10,"div",8)(11,"div",9)(12,"div",10),s(13,"Type"),o(),n(14,"div",11)(15,"label",12)(16,"input",13),p("click",function(){return d(r),m(t.actionType.set("CLIENT"))}),o(),n(17,"div",14),s(18,"Client"),o()(),n(19,"label",12)(20,"input",15),p("click",function(){return d(r),t.actionType.set("SERVER"),m(t.resetFile())}),o(),n(21,"div",14),s(22,"Server"),o()()()(),n(23,"div",16)(24,"label",17),s(25," Name "),o(),_(26,"input",18),o(),y(27,Re,4,0,"div",9),n(28,"div",19)(29,"div",10),s(30,"Context"),o(),n(31,"div",11)(32,"label",12)(33,"input",20),p("click",function(){return d(r),m(t.selectedTitle.set(!t.selectedTitle()))}),o(),n(34,"div",14),s(35,"Selected title"),o()(),n(36,"label",12)(37,"input",21),p("click",function(){return d(r),m(t.library.set(!t.library()))}),o(),n(38,"div",14),s(39,"Library"),o()(),n(40,"label",12)(41,"input",22),p("click",function(){return d(r),m(t.libraryInfo.set(!t.libraryInfo()))}),o(),n(42,"div",14),s(43,"Library info"),o()(),n(44,"label",12)(45,"input",23),p("click",function(){return d(r),m(t.libraryTitles.set(!t.libraryTitles()))}),o(),n(46,"div",14),s(47,"Library titles"),o()()()()(),n(48,"div",24)(49,"button",25),p("click",function(){return d(r),m(t.cancel())}),s(50,"Cancel"),o(),n(51,"button",26),p("click",function(){return d(r),m(t.submit())}),s(52," Add "),o()()()()()}i&2&&(l(9),f("formGroup",t.form),l(7),f("checked",t.actionType()==="CLIENT"),l(4),f("checked",t.actionType()==="SERVER"),l(7),w(t.actionType()==="SERVER"?27:-1),l(6),f("checked",t.selectedTitle()),l(4),f("checked",t.library()),l(4),f("checked",t.libraryInfo()),l(4),f("checked",t.libraryTitles()),l(6),f("disabled",t.form.invalid||t.actionType()==="SERVER"&&!t.isValidFile()))},dependencies:[oe,O,j,B,G,ee,te],encapsulation:2,changeDetection:0})}return a})();var Fe=(()=>{class a{result=new H;form;constructor(e){this.form=e.group({label:["",[R.required,R.minLength(2)]],path:["",[R.required,R.minLength(2)]]})}cancel(){this.result.emit(null),this.form.reset()}submit(){if(this.form.invalid)return;let{label:e,path:i}=this.form.value;this.result.emit({label:e,path:i}),this.form.reset()}static \u0275fac=function(i){return new(i||a)(x(ie))};static \u0275cmp=V({type:a,selectors:[["app-library-modal"]],outputs:{result:"result"},decls:22,vars:2,consts:[["dialog",""],[1,"btn","btn-sm","btn-primary",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke-width","1.5","stroke","currentColor",1,"size-5"],["stroke-linecap","round","stroke-linejoin","round","d","M12 4.5v15m7.5-7.5h-15"],[1,"modal"],[1,"modal-box"],[1,"text-lg","font-bold"],["method","dialog",3,"formGroup"],[1,"my-7"],["for","library-modal-label",1,"label","mb-2"],["id","library-modal-label","type","text","placeholder","Enter the library label","formControlName","label",1,"input","w-full","mb-5"],["for","library-modal-path",1,"label","mb-2"],["id","library-modal-path","type","text","placeholder","Enter the library path","formControlName","path",1,"input","w-full","mb-5"],[1,"modal-action"],[1,"btn","btn-secondary",3,"click"],["type","submit",1,"btn","btn-primary","ml-5",3,"click","disabled"]],template:function(i,t){if(i&1){let r=v();n(0,"button",1),p("click",function(){d(r);let k=L(5);return m(k.showModal())}),h(),n(1,"svg",2),_(2,"path",3),o(),s(3,` Add a library
`),o(),S(),n(4,"dialog",4,0)(6,"div",5)(7,"h2",6),s(8,"Add a library"),o(),n(9,"form",7)(10,"div",8)(11,"label",9),s(12,"Label"),o(),_(13,"input",10),n(14,"label",11),s(15,"Path"),o(),_(16,"input",12),o(),n(17,"div",13)(18,"button",14),p("click",function(){return d(r),m(t.cancel())}),s(19,"Cancel"),o(),n(20,"button",15),p("click",function(){return d(r),m(t.submit())}),s(21," Add "),o()()()()()}i&2&&(l(9),f("formGroup",t.form),l(11),f("disabled",t.form.invalid))},dependencies:[oe,O,j,B,G,ee,te],encapsulation:2,changeDetection:0})}return a})();var De=(()=>{class a{http;constructor(e){this.http=e}get(){return this.http.get("/api/logs")}stream(e){return this.http.post("/api/stream/logs",{enabled:e})}static \u0275fac=function(i){return new(i||a)(me(fe))};static \u0275prov=z({token:a,factory:a.\u0275fac,providedIn:"root"})}return a})();var Ge=["viewport"];function Oe(a,u){if(a&1&&(n(0,"tr",16)(1,"td"),s(2),W(3,"date"),o(),n(4,"td"),s(5),o(),n(6,"td"),s(7),o(),n(8,"td",17),s(9),o()()),a&2){let e=u.$implicit,i=u.odd;D("text-info",e.level==="INFO")("text-warning",e.level==="WARNING")("text-error",e.level==="ERROR")("bg-base-200",i),l(2),N(Q(3,12,e.timestamp,"YYYY-MM-dd HH:mm:ss")),l(3),N(e.source),l(2),N(e.level),l(2),N(e.message)}}var Ne=(()=>{class a{logService;socketService;filter="";logs=b([]);rawLogs=[];subscriptions=[];viewport=U.required("viewport");ngOnDestroy(){this.close()}ngAfterViewInit(){ke(this.viewport())}constructor(e,i){this.logService=e,this.socketService=i}apply(){let e=this.filter,i=null;e.length>0&&(i=new RegExp(Se(e),"i")),this.logs.set(this.rawLogs.filter(t=>!i||i.test(t.source)||i.test(t.level)||i.test(t.message)))}open(e){this.subscriptions.push(this.logService.get().pipe($(i=>{this.rawLogs=i.reverse(),this.logs.set(this.rawLogs),e.showModal()}),ae(()=>this.logService.stream(!0)),ae(()=>this.socketService.on(we)),de(({data:i})=>JSON.parse(i)),$(i=>{this.rawLogs.unshift(i),this.apply()})).subscribe())}close(){this.filter="",this.logs.set([]),this.subscriptions.forEach(e=>e.unsubscribe()),this.logService.stream(!1).subscribe()}static \u0275fac=function(i){return new(i||a)(x(De),x(Ve))};static \u0275cmp=V({type:a,selectors:[["app-log-modal"]],viewQuery:function(i,t){i&1&&q(t.viewport,Ge,5),i&2&&Y()},decls:20,vars:2,consts:[["dialog",""],["viewport",""],[1,"btn","btn-sm","btn-primary",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke-width","1.5","stroke","currentColor",1,"size-5"],["stroke-linecap","round","stroke-linejoin","round","d","M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"],[1,"modal"],[1,"modal-box","md:max-w-[67vw]"],[1,"input","input-ghost","input-sm","mb-2"],["stroke-linecap","round","stroke-linejoin","round","d","M12 3c2.755 0 5.455.232 8.083.678.533.09.917.556.917 1.096v1.044a2.25 2.25 0 0 1-.659 1.591l-5.432 5.432a2.25 2.25 0 0 0-.659 1.591v2.927a2.25 2.25 0 0 1-1.244 2.013L9.75 21v-6.568a2.25 2.25 0 0 0-.659-1.591L3.659 7.409A2.25 2.25 0 0 1 3 5.818V4.774c0-.54.384-1.006.917-1.096A48.32 48.32 0 0 1 12 3Z"],["id","file-tab-filter","type","text","placeholder","Filter",3,"ngModelChange","ngModel"],["method","dialog"],["itemSize","48",1,"h-[67vh]","overflow-auto"],[1,"table"],["class","whitespace-nowrap h-[48px]",3,"text-info","text-warning","text-error","bg-base-200",4,"cdkVirtualFor","cdkVirtualForOf"],[1,"modal-action"],[1,"btn","btn-secondary",3,"click"],[1,"whitespace-nowrap","h-[48px]"],[1,"w-full"]],template:function(i,t){if(i&1){let r=v();n(0,"button",2),p("click",function(){d(r);let k=L(5);return m(t.open(k))}),h(),n(1,"svg",3),_(2,"path",4),o(),s(3,` Show logs
`),o(),S(),n(4,"dialog",5,0)(6,"div",6)(7,"label",7),h(),n(8,"svg",3),_(9,"path",8),o(),S(),n(10,"input",9),F("ngModelChange",function(k){return d(r),I(t.filter,k)||(t.filter=k),m(k)}),p("ngModelChange",function(){return d(r),m(t.apply())}),o()(),n(11,"form",10)(12,"cdk-virtual-scroll-viewport",11,1)(14,"table",12)(15,"tbody"),y(16,Oe,10,15,"tr",13),o()()(),n(17,"div",14)(18,"button",15),p("click",function(){return d(r),m(t.close())}),s(19,"Close"),o()()()()()}i&2&&(l(10),A("ngModel",t.filter),l(6),f("cdkVirtualForOf",t.logs()))},dependencies:[J,ne,O,j,B,G,X,K,Ce,he,ve,be],encapsulation:2,changeDetection:0})}return a})();var Pe=["dialog"];function He(a,u){if(a&1){let e=v();n(0,"div",30),p("click",function(){let t=d(e).$implicit,r=g(2).$implicit,c=g(2);return m(c.assignModels[r.path]=t.aid)}),s(1),o()}if(a&2){let e=u.$implicit;l(),C(" ",(e.ja==null?null:e.ja.main)||e.main," ")}}function We(a,u){if(a&1&&E(0,He,2,1,"div",29,M),a&2){let e=g().$implicit;T(e.titles)}}function ze(a,u){if(a&1){let e=v();n(0,"li",18)(1,"div")(2,"div",19),s(3),o(),n(4,"div")(5,"div",20),p("click",function(){let t=d(e).$implicit,r=g(2);return m(r.showAllMatched()===t.path?r.showAllMatched.set(""):r.showAllMatched.set(t.path))}),s(6),o(),y(7,We,2,0),o(),n(8,"div",21)(9,"label",22)(10,"input",23),F("ngModelChange",function(t){let r=d(e).$implicit,c=g(2);return I(c.assignModels[r.path],t)||(c.assignModels[r.path]=t),m(t)}),o()(),n(11,"button",24),p("click",function(){let t=d(e).$implicit,r=g(2);return m(r.assign(t.path))}),s(12," Assign "),o()()(),n(13,"button",25),p("click",function(){let t=d(e).$implicit,r=g(2);return m(r.ignore(t.path))}),h(),n(14,"svg",26),_(15,"path",27),o()()(),S(),_(16,"div",28)}if(a&2){let e=u.$implicit,i=u.$index,t=g(2);l(3),C(" ",e.path," "),l(3),C(" Matched ",e.titles.length," titles "),l(),w(t.showAllMatched()===e.path?7:-1),l(3),f("id","assign-title-input-"+i),A("ngModel",t.assignModels[e.path]),l(),f("disabled",!t.assignModels[e.path])}}function Ue(a,u){if(a&1&&(n(0,"ul"),E(1,ze,17,6,null,null,M),o()),a&2){let e=g();l(),T(e.overMatched())}}function qe(a,u){if(a&1){let e=v();n(0,"li",18)(1,"div")(2,"div",19),s(3),o(),n(4,"div",21)(5,"label",22)(6,"input",23),F("ngModelChange",function(t){let r=d(e).$implicit,c=g(2);return I(c.assignModels[r.path],t)||(c.assignModels[r.path]=t),m(t)}),o()(),n(7,"button",24),p("click",function(){let t=d(e).$implicit,r=g(2);return m(r.assign(t.path))}),s(8," Assign "),o()()(),n(9,"button",35),p("click",function(){let t=d(e).$implicit,r=g(2);return m(r.remove(t.path))}),h(),n(10,"svg",26),_(11,"path",36),o()()(),S(),_(12,"div",28)}if(a&2){let e=u.$implicit,i=u.$index,t=g(2);l(3),C(" ",e.path," "),l(3),f("id","assign-title-input-"+i),A("ngModel",t.assignModels[e.path]),l(),f("disabled",!t.assignModels[e.path])}}function Ye(a,u){if(a&1){let e=v();n(0,"div",31)(1,"label",32)(2,"input",33),F("ngModelChange",function(t){d(e);let r=g();return I(r.addIgnoredPathModel,t)||(r.addIgnoredPathModel=t),m(t)}),o()()(),n(3,"button",34),p("click",function(){d(e);let t=g();return t.ignore(t.addIgnoredPathModel),m(t.addIgnoredPathModel="")}),s(4," Add "),o(),_(5,"div",28),n(6,"ul"),E(7,qe,13,4,null,null,M),o()}if(a&2){let e=g();l(2),A("ngModel",e.addIgnoredPathModel),l(),f("disabled",e.addIgnoredPathModel.length===0),l(4),T(e.ignored())}}function Qe(a,u){if(a&1){let e=v();n(0,"li",18)(1,"div")(2,"div",40),s(3),n(4,"a",41),h(),n(5,"svg",42),_(6,"path",43),o(),s(7," anidb.net "),o()(),S(),n(8,"div",44),s(9),o(),n(10,"div",21)(11,"label",22)(12,"input",23),F("ngModelChange",function(t){let r=d(e).$implicit,c=g(2);return I(c.assignModels[r.path],t)||(c.assignModels[r.path]=t),m(t)}),o()(),n(13,"button",24),p("click",function(){let t=d(e).$implicit,r=g(2);return m(r.assign(t.path))}),s(14," Assign "),o()()(),n(15,"button",25),p("click",function(){let t=d(e).$implicit,r=g(2);return m(r.ignore(t.path))}),h(),n(16,"svg",26),_(17,"path",27),o()()(),S(),_(18,"div",28)}if(a&2){let e=u.$implicit,i=u.$index,t=g(2);l(3),C(" ",e.aid," "),l(),f("href","https://anidb.net/anime/"+e.aid,pe),l(5),C(" ",e.path," "),l(3),f("id","assign-title-input-"+i),A("ngModel",t.assignModels[e.path]),l(),f("disabled",!t.assignModels[e.path])}}function Je(a,u){if(a&1){let e=v();n(0,"div",31)(1,"label",32)(2,"input",37),F("ngModelChange",function(t){d(e);let r=g();return I(r.addAssignedModel.path,t)||(r.addAssignedModel.path=t),m(t)}),o()(),n(3,"label",38)(4,"input",39),F("ngModelChange",function(t){d(e);let r=g();return I(r.addAssignedModel.aid,t)||(r.addAssignedModel.aid=t),m(t)}),o()()(),n(5,"button",34),p("click",function(){d(e);let t=g();return m(t.addAssigned())}),s(6," Add "),o(),_(7,"div",28),n(8,"ul"),E(9,Qe,19,6,null,null,M),o()}if(a&2){let e=g();l(2),A("ngModel",e.addAssignedModel.path),l(2),A("ngModel",e.addAssignedModel.aid),l(),f("disabled",e.addAssignedModel.path.length===0||e.addAssignedModel.aid===void 0),l(4),T(e.assigned())}}var je=(()=>{class a{document;libraryService;scanningConfigService;configChanged=new H;config={libraryPath:"",assigned:[],ignored:[]};overMatched=b([]);assigned=b([]);ignored=b([]);tab=b("NONE");showAllMatched=b("");assignModels={};addIgnoredPathModel="";addAssignedModel={path:"",aid:void 0};dialog=U.required("dialog");subscriptions=[];ngOnDestroy(){this.subscriptions.forEach(e=>e.unsubscribe())}constructor(e,i,t){this.document=e,this.libraryService=i,this.scanningConfigService=t,this.subscriptions.push(this.scanningConfigService.on().pipe($(({detail:r,tab:c})=>{this.initConfig(r),this.tab.set(c),this.dialog().nativeElement.showModal()})).subscribe())}initConfig(e){let i={libraryPath:e.library.path,assigned:[],ignored:[]};if(e.info){e.info.overMatched>0&&this.libraryService.getOverMatchedTitles(i.libraryPath).subscribe(c=>this.overMatched.set(c));let t=e.info.assigned;Object.keys(t).forEach(c=>{i.assigned.push({path:c,aid:t[c]})});let r=e.info.ignored;Object.keys(r).forEach(c=>{r[c]===!0&&i.ignored.push({path:c})}),this.assigned.set(i.assigned),this.ignored.set(i.ignored)}this.config=i}cancel(){this.tab.set("NONE")}submit(){this.tab.set("NONE"),this.libraryService.setScanningConfig(this.config).subscribe(()=>{this.configChanged.emit(this.config.libraryPath)})}addAssigned(){this.addAssignedModel.path.length>0&&this.addAssignedModel.aid!==void 0&&(this.assignModels[this.addAssignedModel.path]=this.addAssignedModel.aid,this.assign(this.addAssignedModel.path))}assign(e){let i=this.assignModels[e];this.config.ignored=this.config.ignored.filter(r=>r.path!==e);let t=this.config.assigned.find(r=>r.path===e);t?t.aid=i:this.config.assigned.push({path:e,aid:i}),this.overMatched.update(r=>r.filter(c=>c.path!==e)),this.assigned.set(this.config.assigned),this.ignored.set(this.config.ignored)}ignore(e){this.config.assigned=this.config.assigned.filter(t=>t.path!==e),this.config.ignored.find(t=>t.path===e)||this.config.ignored.push({path:e}),this.overMatched.update(t=>t.filter(r=>r.path!==e)),this.assigned.set(this.config.assigned),this.ignored.set(this.config.ignored)}remove(e){this.config.ignored=this.config.ignored.filter(i=>i.path!==e),this.ignored.set(this.config.ignored)}export(){let e=JSON.stringify(this.config,null,2),i=new Blob([e],{type:"application/json"}),t=URL.createObjectURL(i),r=this.document.createElement("a");r.href=t,r.download="scanningConfig.json",this.document.body.appendChild(r),r.click(),this.document.body.removeChild(r),URL.revokeObjectURL(t)}import(e){if(!e.target)return;let i=e.target;if(!i.files||i.files.length===0)return;let t=new FileReader;t.onload=r=>{r.target&&r.target.result&&(this.config=JSON.parse(r.target.result),this.assigned.set(this.config.assigned),this.ignored.set(this.config.ignored),i.value="")},t.readAsText(i.files[0])}static \u0275fac=function(i){return new(i||a)(x(_e),x(Z),x(re))};static \u0275cmp=V({type:a,selectors:[["app-scanning-config"]],viewQuery:function(i,t){i&1&&q(t.dialog,Pe,5),i&2&&Y()},outputs:{configChanged:"configChanged"},decls:31,vars:9,consts:[["dialog",""],[1,"modal"],[1,"modal-box","md:max-w-[67vw]"],[1,"text-lg","font-bold","flex","gap-2"],["data-tip","Export",1,"btn","btn-ghost","btn-square","btn-sm","tooltip","tooltip-bottom","text-secondary",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke-width","1.5","stroke","currentColor",1,"size-6"],["stroke-linecap","round","stroke-linejoin","round","d","M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5m-13.5-9L12 3m0 0 4.5 4.5M12 3v13.5"],["for","scanning-config-import","data-tip","Import",1,"btn","btn-ghost","btn-square","btn-sm","tooltip","tooltip-bottom","text-primary"],["stroke-linecap","round","stroke-linejoin","round","d","M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3"],["id","scanning-config-import","type","file",1,"w-0","h-0",3,"change"],[1,"mt-5","border-1","border-base-300","flex","flex-col","h-[50vh]"],[1,"tabs","tabs-border"],[1,"tab",3,"click"],[1,"grow","overflow-y-auto","overflow-x-hidden"],["method","dialog"],[1,"modal-action"],[1,"btn","btn-secondary",3,"click"],["type","submit",1,"btn","btn-primary","ml-5",3,"click"],[1,"flex","justify-between","m-4"],[1,"font-semibold","text-lg"],["aria-hidden","true",1,"font-semibold","opacity-50","cursor-pointer","hover:bg-base-300","my-2",3,"click"],[1,"join","mt-2"],[1,"input","input-sm","join-item"],["type","number","placeholder","AniDB ID",3,"ngModelChange","id","ngModel"],[1,"btn","btn-sm","btn-primary","join-item",3,"click","disabled"],["data-tip","Ignore",1,"btn","btn-sm","btn-ghost","btn-circle","tooltip","tooltip-left",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke-width","1.5","stroke","currentColor",1,"size-5","text-secondary"],["stroke-linecap","round","stroke-linejoin","round","d","M3.98 8.223A10.477 10.477 0 0 0 1.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.451 10.451 0 0 1 12 4.5c4.756 0 8.773 3.162 10.065 7.498a10.522 10.522 0 0 1-4.293 5.774M6.228 6.228 3 3m3.228 3.228 3.65 3.65m7.894 7.894L21 21m-3.228-3.228-3.65-3.65m0 0a3 3 0 1 0-4.243-4.243m4.242 4.242L9.88 9.88"],[1,"divider","opacity-23","mx-2"],["aria-hidden","true",1,"font-semibold","opacity-50","cursor-pointer","hover:bg-base-300"],["aria-hidden","true",1,"font-semibold","opacity-50","cursor-pointer","hover:bg-base-300",3,"click"],[1,"w-full","px-4","my-4"],[1,"input","w-full"],["id","add-ignored-path-input","type","text","placeholder","Add a path",3,"ngModelChange","ngModel"],[1,"btn","btn-primary","mx-4",3,"click","disabled"],["data-tip","Remove",1,"btn","btn-sm","btn-ghost","btn-circle","tooltip","tooltip-left",3,"click"],["stroke-linecap","round","stroke-linejoin","round","d","m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"],["id","add-assigned-path-input","type","text","placeholder","Add a path",3,"ngModelChange","ngModel"],[1,"input","w-full","mt-4"],["id","add-assigned-aid-input","type","number","placeholder","AniDB ID",3,"ngModelChange","ngModel"],[1,"font-semibold","text-2xl"],["target","_blank","rel","noopener noreferrer",1,"btn","btn-sm","btn-ghost","mb-1",3,"href"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke-width","1.5","stroke","currentColor",1,"size-4"],["stroke-linecap","round","stroke-linejoin","round","d","M13.5 6H5.25A2.25 2.25 0 0 0 3 8.25v10.5A2.25 2.25 0 0 0 5.25 21h10.5A2.25 2.25 0 0 0 18 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25"],[1,"font-semibold","opacity-50"]],template:function(i,t){if(i&1){let r=v();n(0,"dialog",1,0)(2,"div",2)(3,"h2",3)(4,"div"),s(5,"Scanning config"),o(),n(6,"button",4),p("click",function(){return d(r),m(t.export())}),h(),n(7,"svg",5),_(8,"path",6),o()(),S(),n(9,"label",7),h(),n(10,"svg",5),_(11,"path",8),o()(),S(),n(12,"input",9),p("change",function(k){return d(r),m(t.import(k))}),o()(),n(13,"div",10)(14,"div",11)(15,"button",12),p("click",function(){return d(r),m(t.tab.set("OVERMATCHED"))}),s(16," Overmatched "),o(),n(17,"button",12),p("click",function(){return d(r),m(t.tab.set("IGNORED"))}),s(18," Ignored "),o(),n(19,"button",12),p("click",function(){return d(r),m(t.tab.set("ASSIGNED"))}),s(20," Assigned "),o()(),n(21,"div",13),y(22,Ue,3,0,"ul")(23,Ye,9,2)(24,Je,11,3),o()(),n(25,"form",14)(26,"div",15)(27,"button",16),p("click",function(){return d(r),m(t.cancel())}),s(28,"Cancel"),o(),n(29,"button",17),p("click",function(){return d(r),m(t.submit())}),s(30," Apply "),o()()()()()}i&2&&(l(15),D("tab-active",t.tab()==="OVERMATCHED"),l(2),D("tab-active",t.tab()==="IGNORED"),l(2),D("tab-active",t.tab()==="ASSIGNED"),l(3),w(t.tab()==="OVERMATCHED"?22:-1),l(),w(t.tab()==="IGNORED"?23:-1),l(),w(t.tab()==="ASSIGNED"?24:-1))},dependencies:[ne,O,j,Te,B,G,X,K],encapsulation:2,changeDetection:0})}return a})();function Ze(a,u){if(a&1){let e=v();n(0,"label",7)(1,"div",13),_(2,"div",14)(3,"div",15)(4,"div",16)(5,"div",17),o(),n(6,"div",18),s(7),o(),n(8,"input",19),p("click",function(){let t=d(e).$implicit,r=g();return m(r.setTheme(t.name))}),o()()}if(a&2){let e=u.$implicit,i=g();l(),ue("data-theme",e.name==="auto"?i.autoTheme():e.name),l(6),N(e.label),l(),f("checked",i.theme()===e.name)}}function Ke(a,u){if(a&1&&(n(0,"div",23),s(1),o()),a&2){let e=g().$implicit;l(),C(" ",e.info.matched," ")}}function Xe(a,u){if(a&1){let e=v();n(0,"div",26)(1,"button",46),p("click",function(){d(e);let t=g().$implicit,r=g();return m(r.showScanningConfigDialog(t,"OVERMATCHED"))}),s(2),o(),n(3,"button",46),p("click",function(){d(e);let t=g().$implicit,r=g();return m(r.showScanningConfigDialog(t,"IGNORED"))}),s(4),W(5,"count"),o(),n(6,"button",46),p("click",function(){d(e);let t=g().$implicit,r=g();return m(r.showScanningConfigDialog(t,"ASSIGNED"))}),s(7),W(8,"count"),o()()}if(a&2){let e=g().$implicit;l(2),C(" Overmatched: ",e.info.overMatched," "),l(2),C(" Ignored: ",le(5,3,e.info.ignored)," "),l(3),C(" Assigned: ",le(8,5,e.info.assigned)," ")}}function et(a,u){a&1&&_(0,"span",34)}function tt(a,u){a&1&&(h(),n(0,"svg",35),_(1,"path",47),o())}function it(a,u){if(a&1&&s(0),a&2){let e=g().$implicit;C(" Remove library ",e.library.label," ")}}function nt(a,u){if(a&1&&s(0),a&2){let e=g().$implicit;C(" Library ",e.library.label," is in use ")}}function ot(a,u){if(a&1){let e=v();n(0,"li",12)(1,"div",20),s(2),o(),n(3,"div",21)(4,"div",22),s(5),y(6,Ke,2,1,"div",23),o(),n(7,"div",24),s(8),W(9,"date"),o(),n(10,"div",25),s(11),o()(),y(12,Xe,9,7,"div",26),n(13,"div",27)(14,"button",28),p("click",function(){let t=d(e).$index,r=g();return m(r.swap(t-1,t))}),h(),n(15,"svg",29),_(16,"path",30),o()(),S(),n(17,"button",31),p("click",function(){let t=d(e).$index,r=g();return m(r.swap(t,t+1))}),h(),n(18,"svg",29),_(19,"path",32),o()(),S(),n(20,"button",33),p("click",function(){let t=d(e).$implicit,r=g();return m(r.scan(t.library))}),y(21,et,1,0,"span",34)(22,tt,2,0,":svg:svg",35),o(),n(23,"button",36),p("click",function(){let t=d(e).$implicit,r=L(27);return g().checkLibrary(t.library.path),m(r.showModal())}),h(),n(24,"svg",37),_(25,"path",38),o()(),S(),n(26,"dialog",39,0)(28,"div",40)(29,"h2",41),y(30,it,1,1)(31,nt,1,1),o(),n(32,"form",42)(33,"div",43)(34,"button",44),s(35,"Cancel"),o(),n(36,"button",45),p("click",function(){let t=d(e).$index,r=g();return m(r.removeLibrary(t))}),s(37," Remove "),o()()()()()()()}if(a&2){let e=u.$implicit,i=u.$index,t=g();l(2),C(" ",i," "),l(3),C(" ",e.library.label," "),l(),w(e.info?6:-1),l(2),C(" Last scanned: ",Q(9,13,e.info==null?null:e.info.lastScanned,"YYYY-MM-dd HH:mm:ss")||"never"," "),l(3),N(e.library.path),l(),w(e.info?12:-1),l(2),f("disabled",i===0||t.scanning().length>0),l(3),f("disabled",i===t.libraries().length-1||t.scanning().length>0),l(3),f("disabled",t.scanning().length>0),l(),w(t.scanning()===e.library.path?21:22),l(2),f("disabled",t.scanning().length>0),l(7),w(t.isRemovable()?30:31),l(6),f("disabled",!t.isRemovable())}}function rt(a,u){a&1&&(n(0,"div"),s(1,"Selected title"),o())}function at(a,u){a&1&&(n(0,"div"),s(1,"Library"),o())}function lt(a,u){a&1&&(n(0,"div"),s(1,"Library info"),o())}function st(a,u){a&1&&(n(0,"div"),s(1,"Library titles"),o())}function ct(a,u){if(a&1){let e=v();n(0,"button",54),p("click",function(){d(e);let t=g(2);return m(t.setDefaultAction(""))}),h(),n(1,"svg",55),_(2,"path",56),o()()}}function dt(a,u){if(a&1){let e=v();n(0,"button",57),p("click",function(){d(e);let t=g().$implicit,r=g();return m(r.setDefaultAction(t.name))}),h(),n(1,"svg",58),_(2,"path",56),o()()}}function mt(a,u){if(a&1){let e=v();n(0,"li",12)(1,"div",20),s(2),o(),n(3,"div",21)(4,"div",22),s(5),n(6,"div",48),s(7),o()(),n(8,"div",49),y(9,rt,2,0,"div")(10,at,2,0,"div")(11,lt,2,0,"div")(12,st,2,0,"div"),o()(),n(13,"div",27),y(14,ct,3,0,"button",50)(15,dt,3,0,"button",51),n(16,"button",52),p("click",function(){d(e);let t=L(20);return m(t.showModal())}),h(),n(17,"svg",37),_(18,"path",38),o()(),S(),n(19,"dialog",39,1)(21,"div",40)(22,"h2",41),s(23),o(),n(24,"form",42)(25,"div",43)(26,"button",44),s(27,"Cancel"),o(),n(28,"button",53),p("click",function(){let t=d(e).$implicit,r=g();return m(r.removeAction(t.name))}),s(29," Remove "),o()()()()()()()}if(a&2){let e=u.$implicit,i=u.$index;l(2),C(" ",i," "),l(3),C(" ",e.name," "),l(),D("badge-primary",e.type==="CLIENT")("badge-secondary",e.type==="SERVER"),l(),C(" ",e.type," "),l(2),w(e.selectedTitle?9:-1),l(),w(e.library?10:-1),l(),w(e.libraryInfo?11:-1),l(),w(e.libraryTitles?12:-1),l(2),w(e.isDefault?14:15),l(9),C("Remove Action ",e.name,"")}}var Ei=(()=>{class a{config;actionService;libraryService;bookmarkService;scanningConfigService;themes=xe;theme=b("auto");autoTheme=b("auto");libraries=b([]);actions=b([]);scanning=b("");isRemovable=b(!1);constructor(e,i,t,r,c){this.config=e,this.actionService=i,this.libraryService=t,this.bookmarkService=r,this.scanningConfigService=c,this.theme.set(e.getLocalUIConfig().theme),this.autoTheme.set(e.getBrowserTheme()),this.refreshLibraries(),this.refreshActions()}refreshLibraries(){this.libraryService.getDetails().subscribe(e=>this.libraries.set(e))}refreshActions(){this.actionService.getActions().subscribe(e=>this.actions.set(e))}setTheme(e){this.config.setConfig({key:"UI",config:{theme:e}}).subscribe(()=>{this.theme.set(e),this.config.applyUIConfig({theme:e})})}getLibraries(){return this.libraries().map(e=>e.library)}setLibraries(e){this.libraryService.setLibraries(e).pipe($(()=>this.refreshLibraries())).subscribe()}addLibrary(e){if(e){let i=this.getLibraries();this.setLibraries([...i,{index:i.length,label:e.label,path:e.path}])}}swap(e,i){let t=this.getLibraries();[t[e],t[i]]=[t[i],t[e]],t[e].index=e,t[i].index=i,this.setLibraries(t)}checkScanningStatus(e){this.scanning.set(e),this.libraryService.onScanFinished(e).subscribe(()=>{this.scanning.set(""),this.refreshLibraries()})}scan(e){let i=e.path;this.libraryService.scan(i).subscribe(),this.checkScanningStatus(i)}showScanningConfigDialog(e,i){this.scanningConfigService.showDialog(e,i)}checkLibrary(e){this.bookmarkService.get().subscribe(i=>{this.isRemovable.set(!i.some(t=>t.path.startsWith(e)))})}removeLibrary(e){let i=this.getLibraries().filter(t=>t.index!==e).map(t=>(t.index<e||(t.index-=1),t));this.setLibraries(i)}addAction(e){e&&this.actionService.setActions([...this.actions().filter(i=>i.name!==e.name),e]).subscribe(()=>this.refreshActions())}removeAction(e){this.actionService.setActions(this.actions().filter(i=>i.name!==e)).subscribe(()=>this.refreshActions())}setDefaultAction(e){this.actionService.setActions(this.actions().map(i=>(i.isDefault=i.name===e,i))).subscribe(()=>this.refreshActions())}static \u0275fac=function(i){return new(i||a)(x(ye),x(Ee),x(Z),x(Me),x(re))};static \u0275cmp=V({type:a,selectors:[["app-settings"]],decls:33,vars:0,consts:[["removeLibraryDialog",""],["removeActionDialog",""],[1,"h-full","w-full","p-4","overflow-y-auto","overflow-x-hidden"],[1,"mb-13"],[1,"text-xl","font-bold"],[1,"divider"],[1,"grid","grid-cols-1","lg:grid-cols-2","gap-7","m-4"],[1,"label","cursor-pointer"],[1,"flex","items-center","gap-4"],[3,"result"],[3,"configChanged"],[1,"list"],[1,"list-row"],[1,"bg-base-100","grid","shrink-0","grid-cols-2","gap-1","rounded-lg","p-1","shadow-sm","mr-2"],[1,"bg-base-content","size-2","rounded-full"],[1,"bg-primary","size-2","rounded-full"],[1,"bg-secondary","size-2","rounded-full"],[1,"bg-accent","size-2","rounded-full"],[1,"mr-1"],["type","radio","name","theme",1,"radio",3,"click","checked"],[1,"text-5xl","font-thin","opacity-50","tabular-nums"],[1,"font-semibold","list-col-grow"],[1,"text-lg"],[1,"badge","badge-sm","badge-primary","ml-1","mb-1"],[1,"text-info"],[1,"text-xs","opacity-50"],[1,"hidden","md:flex"],[1,"flex","flex-col","md:flex-row"],["data-tip","Move up",1,"btn","btn-ghost","tooltip",3,"click","disabled"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke-width","1.5","stroke","currentColor",1,"size-6"],["stroke-linecap","round","stroke-linejoin","round","d","m4.5 15.75 7.5-7.5 7.5 7.5"],["data-tip","Move down",1,"btn","btn-ghost","tooltip",3,"click","disabled"],["stroke-linecap","round","stroke-linejoin","round","d","m19.5 8.25-7.5 7.5-7.5-7.5"],["data-tip","Scan",1,"btn","btn-ghost","tooltip",3,"click","disabled"],[1,"loading","loading-spinner","text-success"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke-width","1.5","stroke","currentColor",1,"size-6","text-success"],["data-tip","Remove",1,"btn","btn-ghost","tooltip",3,"click","disabled"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke-width","1.5","stroke","currentColor",1,"size-6","text-error"],["stroke-linecap","round","stroke-linejoin","round","d","m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"],[1,"modal"],[1,"modal-box"],[1,"text-lg","font-bold"],["method","dialog"],[1,"modal-action"],[1,"btn","btn-secondary"],["type","submit",1,"btn","btn-primary","ml-5",3,"click","disabled"],[1,"btn","btn-ghost",3,"click"],["stroke-linecap","round","stroke-linejoin","round","d","M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99"],[1,"badge","badge-sm","ml-1","mb-1"],[1,"flex","flex-col","md:flex-row","md:gap-5","opacity-50"],["data-tip","Unset default action",1,"btn","btn-ghost","tooltip"],["data-tip","Set as default action",1,"btn","btn-ghost","tooltip"],["data-tip","Remove",1,"btn","btn-ghost","tooltip",3,"click"],["type","submit",1,"btn","btn-primary","ml-5",3,"click"],["data-tip","Unset default action",1,"btn","btn-ghost","tooltip",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","currentColor","viewBox","0 0 24 24","stroke-width","1.5","stroke","currentColor",1,"size-6","text-warning"],["stroke-linecap","round","stroke-linejoin","round","d","M11.48 3.499a.562.562 0 0 1 1.04 0l2.125 5.111a.563.563 0 0 0 .475.345l5.518.442c.499.04.701.663.321.988l-4.204 3.602a.563.563 0 0 0-.182.557l1.285 5.385a.562.562 0 0 1-.84.61l-4.725-2.885a.562.562 0 0 0-.586 0L6.982 20.54a.562.562 0 0 1-.84-.61l1.285-5.386a.562.562 0 0 0-.182-.557l-4.204-3.602a.562.562 0 0 1 .321-.988l5.518-.442a.563.563 0 0 0 .475-.345L11.48 3.5Z"],["data-tip","Set as default action",1,"btn","btn-ghost","tooltip",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke-width","1.5","stroke","currentColor",1,"size-6","text-warning"]],template:function(i,t){i&1&&(n(0,"div",2)(1,"div",3)(2,"h2",4),s(3,"Theme"),o(),_(4,"div",5),n(5,"div",6),E(6,Ze,9,3,"label",7,M),o()(),n(8,"div",3)(9,"div",8)(10,"h2",4),s(11,"Library"),o(),n(12,"app-library-modal",9),p("result",function(c){return t.addLibrary(c)}),o()(),_(13,"div",5),n(14,"app-scanning-config",10),p("configChanged",function(c){return t.checkScanningStatus(c)}),o(),n(15,"ul",11),E(16,ot,38,16,"li",12,M),o()(),n(18,"div",3)(19,"div",8)(20,"h2",4),s(21,"Action"),o(),n(22,"app-action-modal",9),p("result",function(c){return t.addAction(c)}),o()(),_(23,"div",5),n(24,"ul",11),E(25,mt,30,13,"li",12,M),o()(),n(27,"div",3)(28,"div",8)(29,"h2",4),s(30,"Log"),o(),_(31,"app-log-modal"),o(),_(32,"div",5),o()()),i&2&&(l(6),T(t.themes),l(10),T(t.libraries()),l(9),T(t.actions()))},dependencies:[Le,J,Ie,Fe,je,Ne],encapsulation:2,changeDetection:0})}return a})();export{Ei as SettingsComponent};
