import{a as ie,b as ne,c as oe}from"./chunk-J6Y6CG6Y.js";import{a as Q,b as U,c as X,d as J,e as Y}from"./chunk-7HSRKZAP.js";import{a as Z}from"./chunk-RFR63KKH.js";import"./chunk-3QIFBVMG.js";import{a as ee,c as C,d as te,f as ae}from"./chunk-EZ4CD3YJ.js";import{c as G,d as P,f as D}from"./chunk-GAV62O7C.js";import{w as I,x as $,z as K}from"./chunk-T4XCOYID.js";import{Ab as q,B as M,Cb as d,Eb as _,Fb as V,Ia as y,Ka as n,Pa as u,Q as b,Sa as L,T as S,Va as T,_a as g,fb as v,gb as F,hb as j,ia as w,ib as c,ja as E,jb as H,ka as z,kb as W,lb as B,mb as a,nb as r,ob as h,pb as R,sb as A,tb as s,xa as f,z as N,zb as O}from"./chunk-X3KZUPYP.js";function me(t,l){if(t&1&&(a(0,"h2",4),d(1),r()),t&2){let e=s(2);n(),_(" ",e.label()," ")}}function pe(t,l){if(t&1&&(a(0,"div",18),d(1),r()),t&2){let e=s(2);j("badge-success",e.anime.info.season.endsWith("spring"))("badge-error",e.anime.info.season.endsWith("summer"))("badge-warning",e.anime.info.season.endsWith("autumn"))("badge-info",e.anime.info.season.endsWith("winter")),n(),_(" ",e.anime.info.season.split("/").slice(-2).join(" ")," ")}}function fe(t,l){if(t&1&&(a(0,"div",6),d(1),r()),t&2){let e=s(2);n(),_(" ",e.anime.info.type," ")}}function ue(t,l){if(t&1&&(a(0,"div",8),d(1),r()),t&2){let e=s(2);n(),_(" ",e.anime.info.startDate," ")}}function ge(t,l){t&1&&(a(0,"div",9),d(1,"|"),r())}function ve(t,l){if(t&1&&(a(0,"div",10),d(1),r()),t&2){let e=s(2);n(),_(" ",e.anime.info.endDate," ")}}function he(t,l){if(t&1&&(a(0,"div",12),d(1),r()),t&2){let e=s(2);n(),V(" ",e.anime.info.aggregateRating==null||e.anime.info.aggregateRating.value==null?null:e.anime.info.aggregateRating.value.toFixed(2)," (",e.anime.info.aggregateRating==null?null:e.anime.info.aggregateRating.count,") ")}}function _e(t,l){if(t&1&&(a(0,"div",13),d(1),r()),t&2){let e=s(2);n(),V(" ",e.anime.info.averageRating==null||e.anime.info.averageRating.value==null?null:e.anime.info.averageRating.value.toFixed(2)," (",e.anime.info.averageRating==null?null:e.anime.info.averageRating.count,") ")}}function xe(t,l){if(t&1&&(a(0,"a",15),z(),a(1,"svg",16),h(2,"path",17),r(),d(3," x.com "),r()),t&2){let e=s(2);v("href",e.xLink(),y)}}function Ce(t,l){if(t&1){let e=R();a(0,"div",0)(1,"figure",1),A("click",function(){w(e);let o=s();return E(o.navigate())}),h(2,"img",2),r(),a(3,"div",3),g(4,me,2,1,"h2",4)(5,pe,2,9,"div",5)(6,fe,2,1,"div",6),a(7,"div",7),g(8,ue,2,1,"div",8)(9,ge,2,0,"div",9)(10,ve,2,1,"div",10),r(),a(11,"div",11),g(12,he,2,2,"div",12)(13,_e,2,2,"div",13),r(),a(14,"div",14)(15,"a",15),z(),a(16,"svg",16),h(17,"path",17),r(),d(18," anidb.net "),r(),g(19,xe,4,1,"a",15),r()()()}if(t&2){let e=s();n(2),v("src","/api/content/image/"+e.anime.title.aid,y)("alt",e.anime.title.main||e.anime.title.aid),n(2),c(e.label().length>0?4:-1),n(),c(e.anime.info.season?5:-1),n(),c(e.anime.info.type?6:-1),n(2),c(e.anime.info.startDate?8:-1),n(),c(e.anime.info.startDate&&e.anime.info.endDate?9:-1),n(),c(e.anime.info.endDate?10:-1),n(2),c(e.anime.info.aggregateRating!=null&&e.anime.info.aggregateRating.value&&(e.anime.info.aggregateRating!=null&&e.anime.info.aggregateRating.count)?12:-1),n(),c(e.anime.info.averageRating!=null&&e.anime.info.averageRating.value&&(e.anime.info.averageRating!=null&&e.anime.info.averageRating.count)?13:-1),n(2),v("href","https://anidb.net/anime/"+e.anime.title.aid,y),n(4),c(e.xLink().length>0?19:-1)}}var re=(()=>{class t{router;root=null;anime=null;label=f("");xLink=f("");constructor(e){this.router=e}set title(e){this.anime=e,e!==null&&(this.label.set(I(e.title)),this.xLink.set(this.getXLink(e.info.officialWebsite)||""))}getXLink(e){return e?.split(" ").find(i=>i.includes("twitter.com")||i.includes("x.com"))}navigate(){if(this.root&&this.anime){let e=this.anime.path.slice(this.root.path.length);this.router.navigate(["libraries",this.root.index,K.FILE.route],{queryParams:{path:e}})}}static \u0275fac=function(i){return new(i||t)(u(D))};static \u0275cmp=T({type:t,selectors:[["app-anime-card"]],inputs:{root:"root",title:"title"},decls:1,vars:1,consts:[[1,"card","h-full","w-full","bg-base-100","shadow-lg"],["aria-hidden","true",1,"px-4","pt-4","cursor-pointer","h-83",3,"click"],[1,"rounded-xl","object-cover","h-full","w-full",3,"src","alt"],[1,"card-body","items-center","text-center"],[1,"card-title","text-lg","font-bold"],[1,"badge","badge-soft",3,"badge-success","badge-error","badge-warning","badge-info"],[1,"text-sm","font-semibold","opacity-50"],[1,"flex","items-center","gap-2"],["data-tip","Start date",1,"tooltip"],[1,"text-lg","pb-1","font-bold"],["data-tip","End date",1,"tooltip"],[1,"flex","gap-2"],["data-tip","Aggregate rating",1,"tooltip"],["data-tip","Average rating",1,"tooltip"],[1,"card-actions"],["target","_blank","rel","noopener noreferrer",1,"btn","btn-sm","btn-ghost",3,"href"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke-width","1.5","stroke","currentColor",1,"size-4"],["stroke-linecap","round","stroke-linejoin","round","d","M13.5 6H5.25A2.25 2.25 0 0 0 3 8.25v10.5A2.25 2.25 0 0 0 5.25 21h10.5A2.25 2.25 0 0 0 18 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25"],[1,"badge","badge-soft"]],template:function(i,o){i&1&&g(0,Ce,20,12,"div",0),i&2&&c(o.anime?0:-1)},encapsulation:2,changeDetection:0})}return t})();var be=["container"],Se=["viewport"];function we(t,l){if(t&1&&h(0,"app-anime-card",6),t&2){let e=l.$implicit,i=s(2);v("root",i.library())("title",e)}}function Ee(t,l){if(t&1&&(a(0,"div")(1,"div",5),W(2,we,1,2,"app-anime-card",6,H),r()()),t&2){let e=l.$implicit,i=s();n(),F("grid-template-columns","repeat("+i.rowSize()+", minmax(0, 1fr))"),n(),B(e)}}function le(t){return I(t.title)}function se(t){return t.info.startDate||Te(t.info.season)}function ye(t,l=23){let e=0;return()=>{e&&clearTimeout(e),e=setTimeout(t,l)}}function Te(t){return t?.replace("spring","04-01").replace("summer","07-01").replace("autumn","10-01").replace("winter","01-01").split("/").slice(-2).join("-")||"0000-00-00"}var tt=(()=>{class t{router;route;eventService;explorerService;libraryService;HIDDEN_ANIMATION_DONE="TITLES_HIDDEN";library=f(null);filter="";sort="NAME";rawTitles=[];titles=[];rows=f([]);isLoading=f(!1);subscriptions=[];rowSize=f(5);resizeObserver=null;container=L.required("container");viewport=L.required("viewport");ngOnDestroy(){this.subscriptions.forEach(e=>e.unsubscribe()),this.resizeObserver?.disconnect()}ngAfterViewInit(){this.setRowSize(),te(this.viewport())}setRowSize(){let e=this.container().nativeElement.offsetWidth;if(e>0){let i=Math.max(1,Math.trunc(e/300));this.rowSize()!==i&&(this.rowSize.set(i),this.setRows())}}refreshConfig(){return this.explorerService.titleTabConfig.pipe(S(e=>{this.filter=e.filter,this.sort=e.sort}))}getLibraryIndex(){return this.route.parent?Number(this.route.parent.snapshot.paramMap.get("index")):0}onNavigationEnd(){return N([this.libraryService.getDetail(this.getLibraryIndex()),this.refreshConfig()]).pipe(S(([e])=>{e&&(this.rows.set([]),this.library.set(e.library),this.load(e.library.path))}))}constructor(e,i,o,x,m){this.router=e,this.route=i,this.eventService=o,this.explorerService=x,this.libraryService=m,this.onNavigationEnd().subscribe(),this.subscriptions.push(this.router.events.pipe(M(p=>p instanceof G),b(()=>this.onNavigationEnd())).subscribe()),this.subscriptions.push(this.eventService.on(ie).pipe(b(()=>this.refreshConfig()),S(()=>this.applyConfig())).subscribe()),this.subscriptions.push(this.eventService.on(ne).pipe(b(()=>this.onNavigationEnd())).subscribe())}applyConfig(){let e=this.filter,i=this.sort,o=null;e.length>0&&(o=new RegExp($(e),"i"));let x=this.rawTitles.filter(m=>o!==null?o.test(JSON.stringify(m)):!0).sort((m,p)=>{let k=()=>C(m,p,{by:le});switch(i){case"NAME_R":return C(p,m,{by:le});case"AIRED":return C(m,p,{by:se,fallback:k});case"AIRED_R":return C(p,m,{by:se,fallback:k});default:return k()}});this.titles=x,this.setRows()}setRows(){let e=this.rowSize(),i=[];for(let o=0;o<this.titles.length;o+=e)i.push(this.titles.slice(o,o+e));this.rows.set(i)}setResizeObserver(){let e=ye(()=>{this.setRowSize(),this.viewport().checkViewportSize(),this.isLoading.set(!1)});this.resizeObserver=new ResizeObserver(()=>{this.isLoading()||this.isLoading.set(!0),e()}),this.resizeObserver.observe(this.container().nativeElement)}load(e){this.isLoading()||(this.isLoading.set(!0),this.resizeObserver?.disconnect(),N([this.libraryService.getTitles(e),this.eventService.once(this.HIDDEN_ANIMATION_DONE)]).subscribe(([i])=>{this.rawTitles=i,this.applyConfig(),this.isLoading.set(!1),this.setResizeObserver()}))}onAnimationEnd(e){e.toState==="hidden"&&this.eventService.emit(this.HIDDEN_ANIMATION_DONE)}static \u0275fac=function(i){return new(i||t)(u(D),u(P),u(ee),u(oe),u(ae))};static \u0275cmp=T({type:t,selectors:[["app-title-tab"]],viewQuery:function(i,o){i&1&&(O(o.container,be,5),O(o.viewport,Se,5)),i&2&&q(2)},decls:5,vars:2,consts:[["container",""],["viewport",""],["cdkVirtualScrollingElement","",1,"h-full"],["itemSize","620",1,"h-full"],[4,"cdkVirtualFor","cdkVirtualForOf"],[1,"grid","gap-5"],[1,"h-[600px]","mb-[20px]",3,"root","title"]],template:function(i,o){if(i&1){let x=R();a(0,"div",2,0),A("@fadeAnimation.done",function(p){return w(x),E(o.onAnimationEnd(p))}),a(2,"cdk-virtual-scroll-viewport",3,1),g(4,Ee,4,2,"div",4),r()()}i&2&&(v("@fadeAnimation",o.isLoading()?"hidden":"visible"),n(4),v("cdkVirtualForOf",o.rows()))},dependencies:[re,Y,Q,X,U,J],encapsulation:2,data:{animation:[Z]},changeDetection:0})}return t})();export{tt as TitleTabComponent};
